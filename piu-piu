#!/usr/bin/env bash
#------------------------{ Dev info }-----------------------------------------------------------------------------------
# Created by: Ivan Marov <ie.marov@gmail.com>
# Source: https://github.com/vaniacer/piu-piu-SH                         ‚ñë ‚ñë ‚ñë‚ñë‚ñë ‚ñë ‚ñë‚ñë ‚ñë‚ñë‚ñë‚ñí ‚ñí‚ñí‚ñí‚ñë‚ñë‚ñë ‚ñë‚ñë ‚ñë‚ñë ‚ñë ‚ñë
#--------------------------------------------------------------------+ ‚ñë   ‚ñë‚ñë‚ñë‚ñë ‚ñë‚ñë‚ñë‚ñë‚ñí‚ñí‚ñí‚ñí ‚ñí‚ñí‚ñí‚ñì ‚ñì‚ñì‚ñì‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñë‚ñë‚ñë‚ñë ‚ñë‚ñë‚ñë‚ñë ‚ñë ‚ñë ‚ñë
# Color picker, usage: printf $BLD$CUR$RED$BBLU'Hello World!'$DEF    |   ‚ñë
#-------------------------+--------------------------------+---------+        ‚ñë   ‚ñë‚ñë‚ñë ‚ñë‚ñë     ‚ñë  ‚ñë‚ñë      ‚ñë‚ñë  ‚ñë‚ñë ‚ñë
#       Text color        |       Background color         |         |      ‚ñë   ‚ñë  ‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñë‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñí‚ñà‚ñà‚ñë  ‚ñí‚ñà‚ñà       ‚ñë
#-----------+-------------+--------------+-----------------+         |‚ñë       ‚ñë ‚ñë‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà ‚ñì‚ñì‚ñì‚ñà‚ñà‚ñì ‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà‚ñë‚ñë ‚ñë
# Base color|Lighter shade| Base color   | Lighter shade   |         |     ‚ñë ‚ñë ‚ñë‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà ‚ñí‚ñí‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñë
#-----------+-------------+--------------+-----------------+         |  ‚ñë ‚ñë      ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë ‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà‚ñë‚ñë ‚ñë ‚ñë
BLK='\e[30m'; blk='\e[90m'; BBLK='\e[40m'; bblk='\e[100m' #| Black   |       ‚ñë  ‚ñí‚ñì‚ñà‚ñà‚ñì‚ñì‚ñì‚ñì  ‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñë‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñë     ‚ñë ‚ñë
RED='\e[31m'; red='\e[91m'; BRED='\e[41m'; bred='\e[101m' #| Red     |        ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñë ‚ñë ‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë ‚ñë
GRN='\e[32m'; grn='\e[92m'; BGRN='\e[42m'; bgrn='\e[102m' #| Green   |     ‚ñë ‚ñë‚ñí‚ñì‚ñì‚ñì‚ñì ‚ñë ‚ñë‚ñë‚ñí‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì ‚ñë ‚ñí‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë
YLW='\e[33m'; ylw='\e[93m'; BYLW='\e[43m'; bylw='\e[103m' #| Yellow  |      ‚ñë ‚ñí‚ñí ‚ñë ‚ñë ‚ñë ‚ñë‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí ‚ñë ‚ñë‚ñë‚ñí‚ñí‚ñí‚ñí‚ñë  ‚ñë
BLU='\e[34m'; blu='\e[94m'; BBLU='\e[44m'; bblu='\e[104m' #| Blue    |  ‚ñë ‚ñë                                      ‚ñë     ‚ñë
MGN='\e[35m'; mgn='\e[95m'; BMGN='\e[45m'; bmgn='\e[105m' #| Magenta |‚ñë                      ‚ñë‚ñë ‚ñí‚ñí‚ñà‚ñà‚ñà‚ñë              ‚ñë
CYN='\e[36m'; cyn='\e[96m'; BCYN='\e[46m'; bcyn='\e[106m' #| Cyan    |     ‚ñë ‚ñë ‚ñë        ‚ñë‚ñë‚ñë ‚ñí‚ñà‚ñà‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñë             ‚ñë
WHT='\e[37m'; wht='\e[97m'; BWHT='\e[47m'; bwht='\e[107m' #| White   |  ‚ñë ‚ñë ‚ñë        ‚ñë ‚ñí‚ñà‚ñà‚ñà‚ñà‚ñí‚ñì‚ñì‚ñì‚ñì ‚ñë‚ñë‚ñí‚ñì‚ñì‚ñà‚ñà‚ñà ‚ñë‚ñë ‚ñë
#-------------------------{ Effects }----------------------+---------+             ‚ñë ‚ñí‚ñì‚ñì‚ñì‚ñì ‚ñí‚ñà‚ñà‚ñà‚ñà‚ñë‚ñí‚ñì‚ñà‚ñà‚ñà‚ñë‚ñë
DEF='\e[0m'   #Default color and effects                             |              ‚ñí ‚ñí‚ñí  ‚ñí‚ñì‚ñì‚ñì‚ñì‚ñí‚ñì‚ñà‚ñà‚ñà‚ñë              ‚ñë
BLD='\e[1m'   #Bold\brighter                                         |     ‚ñë ‚ñë         ‚ñë‚ñë‚ñë ‚ñí‚ñí‚ñí ‚ñë‚ñë‚ñí‚ñí‚ñë
DIM='\e[2m'   #Dim\darker                                            |‚ñë ‚ñë
CUR='\e[3m'   #Italic font                                           |          ‚ñë   ‚ñë‚ñë‚ñë ‚ñë‚ñë     ‚ñë  ‚ñë‚ñë      ‚ñë‚ñë  ‚ñë‚ñë ‚ñë
UND='\e[4m'   #Underline                                             |        ‚ñë   ‚ñë  ‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñë‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñí‚ñà‚ñà‚ñë  ‚ñí‚ñà‚ñà        ‚ñë
INV='\e[7m'   #Inverted                                              |   ‚ñë ‚ñë    ‚ñë ‚ñë‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà ‚ñì‚ñì‚ñì‚ñà‚ñà‚ñì ‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà‚ñë‚ñë ‚ñë
COF='\e[?25l' #Cursor Off                                            |       ‚ñë ‚ñë ‚ñë‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà ‚ñí‚ñí‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñë    ‚ñë
CON='\e[?25h' #Cursor On                                             |             ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë ‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà‚ñë‚ñë ‚ñë ‚ñë
#------------------------{ Functions }-------------------------------+‚ñë        ‚ñë  ‚ñí‚ñì‚ñà‚ñà‚ñì‚ñì‚ñì‚ñì  ‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñë‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñë
# Text positioning, usage: XY 10 10 'Hello World!'                   |          ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñë ‚ñë ‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë ‚ñë
XY () { printf "\e[$2;${1}H$3"; }                                   #|       ‚ñë ‚ñë‚ñí‚ñì‚ñì‚ñì‚ñì ‚ñë ‚ñë‚ñë‚ñí‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì ‚ñë ‚ñí‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë
# Print line, usage: line - 10 | line -= 20 | line 'Hello World!' 20 |  ‚ñë     ‚ñë ‚ñí‚ñí ‚ñë ‚ñë ‚ñë ‚ñë‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí ‚ñë ‚ñë‚ñë‚ñí‚ñí‚ñí‚ñí‚ñë  ‚ñë       ‚ñë
line () { printf -v _L %$2s; printf -- "${_L// /$1}"; }             #|
# Create sequence like {0..(X-1)}                                    | ‚ñë ‚ñë ‚ñë ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñí‚ñí‚ñí‚ñí ‚ñí‚ñí‚ñí‚ñì ‚ñì‚ñì‚ñì‚ñí‚ñí‚ñí‚ñí‚ñí‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë ‚ñë ‚ñë ‚ñë ‚ñë ‚ñë
que () { printf -v _N %$1s; _N=(${_N// / 1}); printf "${!_N[*]}"; } #|    ‚ñë ‚ñë ‚ñë‚ñë‚ñë ‚ñë ‚ñë‚ñë ‚ñë‚ñë‚ñë‚ñí ‚ñí‚ñí‚ñí‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë ‚ñë ‚ñë
#--------------------{ check bash version }--------------------------+--------------------------------------------------
tversion=(4 2) # target bash version
vfail(){
    printf "\nYour BASH is too short!) $BLD%s.%s+$DEF required to run this game," ${tversion[@]}
    printf " your is - $BLD%s$DEF\n" $BASH_VERSION
    exit 1
}
(( ${BASH_VERSINFO[0]} >= ${tversion[0]} )) || vfail 1
(( ${BASH_VERSINFO[0]} == ${tversion[0]} )) && { (( ${BASH_VERSINFO[1]} >= ${tversion[1]} )) || vfail 2; }
#----{ Start opt }--------------------------------------{ description  }---------------------{ def. values }------------
  background=true                                       # background objects visibility             (true)
    storyspd=0.05                                       # story texting speed                       (0.05)
    bossborn=                                           # boss starter
    tillboss=100                                        # frags needed to fight with boss           (100)
     version='‚ÇÅ‚Ä§‚ÇÅ'                                      # game version in small digits ‚ÇÄ‚ÇÅ‚ÇÇ‚ÇÉ‚ÇÑ‚ÇÖ‚ÇÜ‚Çá‚Çà‚Çâ‚Ä§
     bhealth=100                                        # boss' health                              (100)
     showfps=true                                       # show FPS counter if set                   (true)
     enumber=0                                          # enemies counter                           (0)
     bonuses=("ammo" "life" "ammo" "gunup" "ammo")      # bonuses, more ammo, less life ang gun power ups
       enmax=100                                        # max number of enemies                     (10)
       crate=0                                          # crate drop                                (0)
       frags=0                                          # hero1 frags counter                       (0)
        life=3                                          # hero1 life counter                        (3)
        ammo=100                                        # hero1 ammo counter                        (100)
         DHC=$BLK                                       # default hero color                        ($BLK)
         DSC=$RED                                       # default symbol color                      ($RED)
         rnd=10                                         # random seed 4 bonuses                     (10)
         DHS='‚òÖ'                                        # default symbol                            (‚òÖ)
         spd=0.0001                                     # game\read speed                           (0.0001)
         MSN=1111                                       # messenger randomizer                      (1111)
         HOU=1111                                       # houses randomizer                         (1111)
          ad='Die alien scum!'                          # ad plane message                          'Die alien scum!'
           G=1                                          # gun                                       (1)(max 5)
read year month day dow < <(LANG=C date +'%Y %m %d %a') # get year, month, day and day of week at once
#----{ Multipleyer config }-----------------------------{ description  }---------------------{ def. values }------------
      frags2=0                                          # hero2 frags counter                       (0)
       life2=3                                          # hero2 life counter                        (3)
       ammo2=100                                        # hero2 ammo counter                        (100)
          G2=1                                          # hero2 gun                                 (1)(max 5)
       caddr=( $(hostname -I) )
       saddr=
       sport=54321
       cport=54322

[[ -e ~/.piuconf ]] && . ~/.piuconf
#================================================{ Functions }==========================================================
bye () { cursor on; exit $1; }

cursor () {
    case $1 in
         on) stty  echo; printf "$CON";;
        off) stty -echo; printf "$COF";;
    esac
}

mov () {
    case $1  in -) cuter=++;; +) cuter=--;; esac
    case $SC in
         (0) [[ $OX -le -$OW   ]] && return 1
             [[ $OX -gt  $endx ]] && return 1
             [[ $AS -ge  $AL   ]] && AS=0  || ((AS++)) # sprites animation
             [[ $OX -le  1     ]] && ((CS++))
             ((OX$1$1)); ((CL$cuter)); SC=$SM
             [[ $CL -lt 0 ]] && CL=0;;
         (*) ((SC--));;
    esac
    [[ $OX -le 1 ]] && SX=0 || SX=$OX
}

cut () {
    xcord=$1 ycord=$2 color=$3; shift 3
    screen+="\e[$ycord;${xcord}H$color"
    printf -v spr %s "${@:$CS:$CL}"
    spr="${spr//_Y_/'\e['$ycord;}"
    screen+="${spr//‚éï/ }"
}

movy () {
    case $SC:$1 in
          (*:-) [[ $OY -le 1         ]] && return 1;;&
          (*:+) [[ $OY -ge $[endy-2] ]] && return 1;;&
          (0:*) [[ $AS -ge $AL  ]] && AS=0 || ((AS++))
                [[ $CS -le $OH  ]] && ((CS++))
                ((OY$1$1)); SC=$SM;;
          (*:*) ((SC--));;
    esac
}

cuty () { # used in bonus crate
    xcord=$1 ycord=$2 cuter=$3 ypos=$[ycord-cuter]; shift 3
    [[ $ypos -lt 1    ]] && ypos=1
    [[ $CS -ge $cuter ]] && spr="\e[$ypos;${xcord}H$@" screen+="${spr//‚éï/ }"
}

bonus () { # get random bonus from alien or not
    ((RANDOM % $rnd == 0)) && ENM+=("${bonuses[$[RANDOM%${#bonuses[@]}]]} $OX $[OY-1] 3 5 0 2 1 0 0 0 ${#ENM[@]}")
}

mess () {
    cursor off
    XY 1 1 ${DEF}; clear
    case $1 in
        win ) sprite_win ; XY 0 ${endy}; read -t3 -n1000 trash; the_story; return 0;;
        lose) sprite_lose; XY 0 ${endy}; read -t3 -n1000 trash; bye 1;;
        tobe) sprite_tobe; XY 0 ${endy}; read -t3 -n1000 trash; bye 1;;
        help) sprite_help;;
    esac
}

print_sprite () {
    OT=${OI[0]}   # object type
    OX=${OI[1]}   # object X coordinate
    OY=${OI[2]}   # object Y coordinate
    OH=${OI[3]}   # object height
    OW=${OI[4]}   # object width
    SC=${OI[5]}   # speed counter
    SM=${OI[6]}   # speed max
    CS=${OI[7]}   # cutting start
    CL=${OI[8]}   # cutting length
    AS=${OI[9]}   # animation start
    AL=${OI[10]}  # animation length
    C1=${OI[11]}  # custom obj parameter 1
    C2=${OI[12]}  # custom obj parameter 2
    [[ $OT ]] &&  sprite_$OT
}

read_input () { read -t$spd -srn1 input  &>/dev/null ; }
listener   () { input2=$(nc -l -p $sport 2>/dev/null); }
sender     () { until nc -q0 $1 $2 2>/dev/null <<< "$3"; do :; done; }

control_hero1 () {
    local L=0
    read_input
    [[ $penis ]] && L=G
    case ${input,,} in
           w) (( H1Y  > 2            )) && ((H1Y--));;
           a) (( H1X  > 2            )) && ((H1X--));;
           s) (( H1Y  < heroendy     )) && ((H1Y++));;
           d) (( H1X  < (heroendx-L) )) && ((H1X++));;
           p) (( ammo > G && C1 == 0 )) && { C1=7; add_piu $(($1+L)) $2 1 $G; ((ammo-=$G)); };;
    esac
}

control_hero2 () {
    local L=0
    [[ $penis ]] && L=G2
    [[ $duel  ]] || L=0
    case ${input2,,} in
           w) (( H2Y   > 2             )) && ((H2Y--));;
           a) (( H2X   > 2             )) && ((H2X--));;
           s) (( H2Y   < heroendy      )) && ((H2Y++));;
           d) (( H2X   < (heroendx-L)  )) && ((H2X++));;
           p) (( ammo2 > G2 && C1 == 0 )) && { C1=7; add_piu $(($1+L)) $2 2 $G2; ((ammo2-=$G2)); };;
    esac
}

gunmax=5
[[ $penis ]] && gunmax=50
rndmbonus () {
    case $1:$[RANDOM%3] in
          1:0) ((life++)) ;;
          2:0) ((life2++));;
          1:1) ((ammo+=100)) ;;
          2:1) ((ammo2+=100));;
          1:2) [[ $G  -lt 5 ]] && ((G++)) ;;
          2:2) [[ $G2 -lt 5 ]] && ((G2++));;
    esac
}
collbooom () { unset ENM[obj_i]; boom $obj_x $obj_y; }
collision () {
    hero=$1 re="$2"
    case $type in
        'duel') target=("${HER[@]}" "${ENM[@]}");;
             *) target=("${ENM[@]}");;
    esac
    [[ ${target[@]} =~ $re ]] && {
        match=($BASH_REMATCH)
        obj_i=${match[@]:11:1}
        obj_x=${match[@]:1:1}
        obj_y=${match[@]:2:1}
        case $match:$hero in
              bfire:*) collbooom; return 0;;
               boss:*) ((bhealth--)); boom $3 $4; return 0;;
               life:1) collbooom; ((life++))    ; return 1;;
               life:2) collbooom; ((life2++))   ; return 1;;
               ammo:1) collbooom; ((ammo+=100)) ; return 1;;
               ammo:2) collbooom; ((ammo2+=100)); return 1;;
#             alien:*) collbooom; ((enumber--)) ; return 0;;
              gunup:1) collbooom; [[ $G  -lt $gunmax ]] && ((G++))   ; return 1;;
              gunup:2) collbooom; [[ $G2 -lt $gunmax ]] && ((G2++))  ; return 1;;
              alien:1) collbooom; ((enumber--)) ; ((frags++)) ; bonus; return 0;;
              alien:2) collbooom; ((enumber--)) ; ((frags2++)); bonus; return 0;;
              hero1:2|penis1:2 )  ((frags2++))  ; ((life--))  ; BOOM $obj_x $obj_y ; return 0;;
              hero2:1|penis2:1 )  ((frags++))   ; ((life2--)) ; BOOM $obj_x $obj_y ; return 0;;
              crate:*) collbooom; crate=0; boom $obj_x $[obj_y-3]; boom $obj_x $[obj_y-6]; rndmbonus $hero; return 1;;
        esac
    }
}

boom () {
    XB=$1 YB=$2
    [[ $XB -lt     2     ]] && XB=2
    [[ $XB -gt $boomendx ]] && XB=$boomendx
    BP3+=("boom $XB $YB 0 0 0 $[RANDOM%3] 1 9 0 5")
}

BOOM () {  XB=$1   YB=$2
    boom  $XB    $[YB+1]
    boom $[XB+4]  $YB
    boom $[XB+1] $[YB+1]
    boom $[XB+3]  $YB
    boom  $XB    $[YB+1]
}

fps_counter () { #-{ Print FPS }-----------------------------------------------
    [[ $SECONDS -gt $sec ]] && {
        FPS=$FPSC AVG+=($FPS)
        [[ $FPSL ]] || FPSL=$FPS
        [[ $FPS -gt $FPSM  ]] && FPSM=$FPS
        [[ $FPS -lt $FPSL  ]] && FPSL=$FPS
        (( ${#AVG[@]} == 5 )) && { avg="${AVG[@]}"; FPSA=$(( (${avg// /+})/5 )); AVG=(); }
        sec=$SECONDS
        FPSC=0
    } || ((FPSC++))
    case $game in
        'server') screen+="\e[$endy;$[endx-9]H$LND${BLK}FPS: $RED$FPS $DEF";;
               *) screen+="\e[$endy;2H$LND${BLK}FPS: $RED$FPS ${BLK}max: $RED$FPSM ${BLK}low: $RED$FPSL ${BLK}avg: $RED$FPSA $DEF";;
    esac
}

status () { #-{ Print game status }--------------------------------------------
    case $type:$virus in
         (duel:*       ) enemy=rival   bullets=Ammo;;
         (   *:covid-19) enemy=viruses bullets=Meds;;
         (team:*       ) enemy=aliens  bullets=Ammo;;
    esac
    screen+="\e[1;2H$SKY${BLK}Killed $enemy: $SKY$RED$frags$SKY ${BLK}Life: $SKY$RED$life$SKY ${BLK}$bullets: $SKY$RED$ammo$SKY "
    case $game in 'server')
        screen+="\e[$endy;2H$LND${BLK}Killed $enemy: $LND$RED$frags2$LND ${BLK}Life: $LND$RED$life2$LND ${BLK}$bullets: $LND$RED$ammo2$LND ";;
    esac
}

boss_health () {
    bar=; hp=$((bosshbar * bhealth / 100)); hm=$((endx - 10))
    for (( i=0  ; i<hp; i++ )); do bar="‚ñà$bar"; done
    for (( i=$hp; i<hm; i++ )); do bar="$bar "; done
    screen+="\e[$((endy-1));1H$LND $BLD${RED}BOSS: $LND$BLK|$BLD$RED$bar$LND$BLK|$LND"
}

fill_screen () {
    for ((i=0;        i<landendy; i++)); do printf "$SKY%${endx}s"; done
    for ((i=landendy; i<endy;     i++)); do printf "$LND%${endx}s"; done
}

drop_crate () { # in duel mode ad plane'll drop bonus crate
    case $type:$crate in duel:0)
        [[ $OX -eq $halfx ]] && { crate=1 ENM+=("crate $halfx 6 7 7 0 $[RANDOM%5+5] 0 0 0 0 ${#ENM[@]}"); };;
    esac
}

add_enm () {
    [[ $BR -gt 0 ]] && ((BR--))
    [[ $enumber -lt $enmax && $BR -eq 0 ]] || return
    ENM+=("alien $1 $2 3 5 0 $[RANDOM%2] 1 ${3:-0} $[RANDOM%3] 3 ${#ENM[@]}")
    ((enumber++))
    BR=20
}

add_piu () {
    local PX=$1 PY=$2 PH=$3 PS=$4
    case $PS:$PH:$type in
           1:*:*)    PIU+=("piu$PH $[PX+12] $[PY+3] 1 4 0 0 1 $[endx-(PX+12)] $[RANDOM%3] 3");; # -=>

           2:*:*)    PIU+=("piu$PH $[PX+12] $[PY+4] 1 4 0 0 1 $[endx-(PX+12)] $[RANDOM%3] 3"    # -=>
                                                                                                #
                           "piu$PH $[PX+12] $[PY+2] 1 4 0 0 1 $[endx-(PX+12)] $[RANDOM%3] 3");; # -=>

           3:2:duel) PIU+=("piu$PH $[PX+13] $[PY+2] 1 4 0 0 1 $[endx-(PX+13)] $[RANDOM%3] 3"    #  <=-
                           "piu$PH $[PX+12] $[PY+3] 1 4 0 0 1 $[endx-(PX+12)] $[RANDOM%3] 3"    # <=-
                           "piu$PH $[PX+13] $[PY+4] 1 4 0 0 1 $[endx-(PX+13)] $[RANDOM%3] 3");; #  <=-

           3:*:*)    PIU+=("piu$PH $[PX+12] $[PY+2] 1 4 0 0 1 $[endx-(PX+12)] $[RANDOM%3] 3"    # -=>
                           "piu$PH $[PX+13] $[PY+3] 1 4 0 0 1 $[endx-(PX+13)] $[RANDOM%3] 3"    #  -=>
                           "piu$PH $[PX+12] $[PY+4] 1 4 0 0 1 $[endx-(PX+12)] $[RANDOM%3] 3");; # -=>

           4:2:duel) PIU+=("piu$PH $[PX+13] $[PY+1] 1 4 0 0 1 $[endx-(PX+13)] $[RANDOM%3] 3"    #  <=-
                           "piu$PH $[PX+12] $[PY+2] 1 4 0 0 1 $[endx-(PX+12)] $[RANDOM%3] 3"    # <=-
                                                                                                #
                           "piu$PH $[PX+13] $[PY+4] 1 4 0 0 1 $[endx-(PX+13)] $[RANDOM%3] 3"    # <=-
                           "piu$PH $[PX+12] $[PY+5] 1 4 0 0 1 $[endx-(PX+12)] $[RANDOM%3] 3");; #  <=-

           4:*:*)    PIU+=("piu$PH $[PX+12] $[PY+1] 1 4 0 0 1 $[endx-(PX+12)] $[RANDOM%3] 3"    # -=>
                           "piu$PH $[PX+13] $[PY+2] 1 4 0 0 1 $[endx-(PX+13)] $[RANDOM%3] 3"    #  -=>
                                                                                                #
                           "piu$PH $[PX+12] $[PY+4] 1 4 0 0 1 $[endx-(PX+12)] $[RANDOM%3] 3"    #  -=>
                           "piu$PH $[PX+13] $[PY+5] 1 4 0 0 1 $[endx-(PX+13)] $[RANDOM%3] 3");; # -=>

           *:2:duel) PIU+=("piu$PH $[PX+14] $[PY+1] 1 4 0 0 1 $[endx-(PX+14)] $[RANDOM%3] 3"    #   <=-
                           "piu$PH $[PX+13] $[PY+2] 1 4 0 0 1 $[endx-(PX+13)] $[RANDOM%3] 3"    #  <=-
                           "piu$PH $[PX+12] $[PY+3] 1 4 0 0 1 $[endx-(PX+12)] $[RANDOM%3] 3"    # <=-
                           "piu$PH $[PX+13] $[PY+4] 1 4 0 0 1 $[endx-(PX+13)] $[RANDOM%3] 3"    #  <=-
                           "piu$PH $[PX+14] $[PY+5] 1 4 0 0 1 $[endx-(PX+14)] $[RANDOM%3] 3");; #   <=-

           *:*:*)    PIU+=("piu$PH $[PX+12] $[PY+1] 1 4 0 0 1 $[endx-(PX+12)] $[RANDOM%3] 3"    # -=>
                           "piu$PH $[PX+13] $[PY+2] 1 4 0 0 1 $[endx-(PX+13)] $[RANDOM%3] 3"    #  -=>
                           "piu$PH $[PX+14] $[PY+3] 1 4 0 0 1 $[endx-(PX+14)] $[RANDOM%3] 3"    #   -=>
                           "piu$PH $[PX+13] $[PY+4] 1 4 0 0 1 $[endx-(PX+13)] $[RANDOM%3] 3"    #  -=>
                           "piu$PH $[PX+12] $[PY+5] 1 4 0 0 1 $[endx-(PX+12)] $[RANDOM%3] 3");; # -=>
    esac
}

backgound_birds () { # Add birds }----------------------------------------------------------------------
    case $[RANDOM % $BRD] in 0) BP1+=("bird  $endx $rndy 2 2  0 $[3+RANDOM%3] 1 0 $[RANDOM%2] 2");; esac
}

backgound_msngr () { # Add msngr }----------------------------------------------------------------------
    case $type in duel) msngrY=2;; *) msngrY=$rndy;; esac
    case $[RANDOM % $MSN] in 0)
        ((ad_index++)); [[ ${ad[ad_index]} ]] || ad_index=0
        BP2+=("msngr $endx $msngrY 4 ${width[ad_index]} 0 $[1+RANDOM%4] 1 0 $[RANDOM%3] 3 $ad_index");;
        #              1      2    3         4          5       6       7 8      9      10    11
    esac
}

backgound_clouds () { # Add clouds }--------------------------------------------------------------------
    case $[RANDOM % $CLD]:$[RANDOM % 3 + 1] in
        0:1) BP1+=("cloud1 $endx $rndy 3 6  6 $[6+RANDOM%2] 1 0 0 0");;
        0:2) BP2+=("cloud2 $endx $rndy 3 8  4 $[4+RANDOM%2] 1 0 0 0");;
        0:3) BP3+=("cloud3 $endx $rndy 3 11 2 $[2+RANDOM%2] 1 0 0 0");;
    esac
}

backgound_houses () { # Add houses }--------------------------------------------------------------------
    case $[RANDOM % $HOU]:$[RANDOM % 3 + 1] in
        0:1)                 BP1+=("house1 $endx $hos1endy 2 6  6 $[6+RANDOM%2] 1 0 0 0");;
        0:2) [[ $penis ]] || BP2+=("house2 $endx $hos2endy 9 30 4 $[4+RANDOM%2] 1 0 0 0");;
        0:3)                 BP3+=("house3 $endx $hos3endy 4 17 2 $[2+RANDOM%2] 1 0 0 0");;
    esac
}

backgound_trees () { # Add trees }----------------------------------------------------------------------
    case $[RANDOM % $TRE]:$[RANDOM % 3 + 1] in
        0:1) BP1+=("tree1 $endx $tre1endy 3 2 6 $[6+RANDOM%2] 1 0 0 0");;
        0:2) BP2+=("tree2 $endx $tre2endy 6 5 4 $[4+RANDOM%2] 1 0 0 0");;
        0:3) BP3+=("tree3 $endx $tre3endy 9 9 2 $[2+RANDOM%2] 1 0 0 0");;
    esac
}

backgound_moving_land () { # Print moving land }--------------------------------------------------------
    screen+="\e[$landendy;1H$LND${land:$((1-${LX:-1})):$endx}"; [[ ${LX:-1} -lt -$[$LN/2] ]] && LX=-1 || ((LX--))
}

backgound_land () { # Print land }----------------------------------------------------------------------
    screen+="\e[$landendy;1H$LND${land:$((1-${LX:-1})):$endx}"
}

add_backgound () {
    rndy=$[2+RANDOM%10]; [[ $rndy -gt $[3+enmyendy] ]] && rndy=$[3+enmyendy]
    for item in "$@"; { backgound_$item; }
}

#------------------------{ Intro }--------------------------------------------------------------------------------------
intro () {
    i=0  #    start X                           target X
    INT=("PIU $endx 3 9 41 0 0 1 0          0 0 $[endx/2-35]"
         "PIU $endx 3 9 41 0 0 1 0          0 0 $[endx/2-1]"
         "ARR 1    12 6 28 0 0 0 $[endx-29] 0 0 $[endx/2-16]")
    while true; do
        sleep $spd; screen=
        OI=(${INT[i]})
        print_sprite || ((i++))
        printf "$screen"
        [[ $i -gt ${#INT[@]} ]] && break
    done
    XY $[endx/2+32] 11 "$version"
}

HCI=0 SCI=1 HSI=0 H1C=${H1C:-$DHC} H1S=${H1S:-$DHS} S1C=${S1C:-$DSC}
hero_sign=(‚òÖ ‚ò≠ ‚úö ‚úô ‚ú† ‚ú° ‚ú¶ ‚úß ‚ú© ‚ú™ ‚òò ‚ò† ‚ò¢ ‚ò£ ‚òØ ‚ùÉ ‚ùÇ ‚ùÅ ‚úø ‚ùÄ ‚ú£ ‚ô£ ‚ô† ‚ô• ‚ô¶ ‚ù§ ‚óè ‚òª ‚ôÄ ‚ôÇ)
hero_color=($BLK $RED $GRN $YLW $BLU $MGN $CYN $WHT)
sign_color=($BLK $RED $GRN $YLW $BLU $MGN $CYN $WHT)
hero_config () {
    screen=
    [[ $AS -gt 0 ]] && ((AS--)) || AS=3
    CS=1 CL=20 H1X=$OX H1Y=$OY
    sprite_${ht}1 stop
    printf "$screen"

    for i in ${!hero_sign[@]}; {
        [[ $i -eq $HSI ]] && selected=$DEF$BLD$RED || selected=$DEF
        [[ $i -lt $[${#hero_sign[@]}/2] ]] \
            && XY $[MX+12+i*2] $MY     "$selected${hero_sign[i]}$DEF" \
            || XY $[MX+12+i*2-${#hero_sign[@]}] $[MY+1] "$selected${hero_sign[i]}$DEF"
    }
    for i in ${!sign_color[@]}; {
        [[ $i -eq $SCI ]] && selected=$BLD || selected=$DEF
        XY $[MX+12+i*2] $[MY+2] "$selected${sign_color[i]}‚óè$DEF"
    }
    for i in ${!hero_color[@]}; {
        [[ $i -eq $HCI ]] && selected=$BLD || selected=$DEF
        XY $[MX+12+i*2] $[MY+3] "$selected${hero_color[i]}‚óè$DEF"
    }
}

submenu () {
    case "${items[item]}$1" in
        'Hero  sign+') [[ $HSI -lt $[${#hero_sign[@]}-1] ]] && ((HSI++));;
        'Hero  sign-') [[ $HSI -gt 0 ]] && ((HSI--));;
        'Sign color+') [[ $SCI -lt $[${#sign_color[@]}-1] ]] && ((SCI++));;
        'Sign color-') [[ $SCI -gt 0 ]] && ((SCI--));;
        'Hero color+') [[ $HCI -lt $[${#hero_color[@]}-1] ]] && ((HCI++));;
        'Hero color-') [[ $HCI -gt 0 ]] && ((HCI--));;
    esac
    H1C=${hero_color[HCI]} H1S=${hero_sign[HSI]} S1C=${sign_color[SCI]}
}

item=1
selector () {
    read -t$spd -srn1 input &> /dev/null
    case $input in
        [wW]) [[ $item -gt 1 ]] && ((item--));;
        [aA]) submenu -;;
        [sS]) [[ $item -lt $[${#items[@]}-1] ]] && ((item++));;
        [dD]) submenu +;;
        [pP]) return $item;;
    esac;     return 0
}

printf -v eraser %40s
clr    () { for i in ${!items[@]}; { XY $MX $[MY+i] "$eraser"; }; }
Hero   () { :; }
Sign   () { :; }
back   () { clr; menu; }
start  () { return  1; }
team   () { type=duel; multiplayer; }
duel   () { type=team; multiplayer; }
server () { game=server; clr; menu; }
single () { game=single; clr; menu; }
cancel () { apply; H1C=$DHC; H1S=$DHS; S1C=$DSC; }
client () { clr; game=client; enter_server; clr; menu; }
apply  () { printf "$DEF"; clear; intro; show_hero=; item=1; items=('' "start $game" 'multiplayer' 'configure' 'exit'); }
multiplayer  () { clr; items=('' 'server' 'client' 'single' "$type" 'back'); }
enter_server () {
    XY $[$endx/2-10] $[$endy-4] "${RED}Enter server IP: "
    XY $[$endx/2-10] $[$endy-3] "$BLD$WHT"
    cursor on; read -p ' ' -i "$saddr" -e saddr; cursor off
}
configure    () {
    clear
    show_hero=1
    items=('' 'Hero  sign' 'Sign color' 'Hero color' 'apply' 'cancel')
    OX=$[$endx/2-9] OY=$[$endy/2-6]
    for i in {0..7}; { XY $((OX-1)) $((OY+i)) "$SKY                    "; }
}

game=single
type=team
menu () {
     item=1 MX=$[$endx/4+4] MY=$[$endy-6]
    items=('' "start $game" 'multiplayer' 'configure' 'exit')
    while true; do
        selector || ${items[$?]// */} || break
        [[ $show_hero ]] && hero_config
        for i in ${!items[@]}; {
            [[ $i -eq $item ]] && selected=$BLD$RED || selected=$DEF
            XY $MX $[MY+i] "$selected${items[i]}$DEF"
        }
    done
}
#================================================{ Messages }===========================================================
september_the_3rd=(
    '–Ø –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø–µ—Ä–µ–≤–µ—Ä–Ω—É'
    '–ò —Å–Ω–æ–≤–∞ —Ç—Ä–µ—Ç—å–µ —Å–µ–Ω—Ç—è–±—Ä—è'
    '–ù–∞ —Ñ–æ—Ç–æ —è —Ç–≤–æ—ë –≤–∑–≥–ª—è–Ω—É'
    '–ò —Å–Ω–æ–≤–∞ —Ç—Ä–µ—Ç—å–µ —Å–µ–Ω—Ç—è–±—Ä—è'
    '–ù–æ –ø–æ—á–µ–º—É, –Ω–æ –ø–æ—á–µ–º—É'
    '–†–∞—Å—Å—Ç–∞—Ç—å—Å—è –≤—Å—ë –∂–µ –Ω–∞–º –ø—Ä–∏—à–ª–æ—Å—å?'
    '–í–µ–¥—å –±—ã–ª–æ –≤—Å—ë —É –Ω–∞—Å –≤—Å–µ—Ä—å—ë–∑'
    '–í—Ç–æ—Ä–æ–≥–æ —Å–µ–Ω—Ç—è–±—Ä—è'
    '–ù–æ –ø–æ—á–µ–º—É, –Ω–æ –ø–æ—á–µ–º—É'
    '–†–∞—Å—Å—Ç–∞—Ç—å—Å—è –≤—Å—ë –∂–µ –Ω–∞–º –ø—Ä–∏—à–ª–æ—Å—å?'
    '–í–µ–¥—å –±—ã–ª–æ –≤—Å—ë —É –Ω–∞—Å –≤—Å–µ—Ä—å—ë–∑'
    '–í—Ç–æ—Ä–æ–≥–æ —Å–µ–Ω—Ç—è–±—Ä—è ... '
)

case "$day$month${virus,,}${dow,,}" in
   *covid-19*) ad='Stay at home!'                              ;;&
        *fri*) ad='All work and no play makes Jack a dull boy' ;;&
        2[5-9]07*fri|3[01]07*fri) ad='Sysadmins will save us all!';; # Last friday of july Sysadmin day!)
        0112*) ad="Winter is coming..."                        ;;
        3112*) ad="Happiu-piu new $((year+1))"' year!)'        ;;
        1101*) ad='Happy birthday Yura $)'                     ;;
        0202*) ad='It is groundhog day, again !)'              ;;
        2002*) ad='Happy birthday Romka !)'                    ;;
        2302*) ad='Where is my socks and shaving foam!?'       ;;
        2802*) ad='Happy birthday Matvey !)'                   ;;
        0803*) ad='Hold on guyz $)'                            ;;
        1803*) ad='Happy birthday Ivinco !)'                   ;;
        0905*) ad='–î–µ–Ω—å –ø–æ–±–µ–¥—ã!'                               ;;
        3006*) ad='Happy birthday Natusya !)'                  ;;
        0309*) ad=("${september_the_3rd[@]}") MSN=333          ;;
esac

#------------------------{ Ad plane text }------------------------------------------------------------------------------
ad_index=0
ad_plane_text () {
    case $type in duel) ad='Try to catch this!' ad_new=;; esac
    CM4= CM5=; case "$day$month" in 0905) CM4=$bylw CM5=$bblk;; esac

    for ad_index in ${!ad[@]}; do
        ad_new=
        line_new=
        ad_text=${ad[ad_index]}
        for ((i=0; i<${#ad_text}; i++)); {
            ad_new+="$CM5$BLD$red${ad_text:$i:1} "
            line_new+="$CM4$blk- "
        }
        line[ad_index]=${line_new//  /‚éï }
        new_ad[ad_index]=${ad_new//  /‚éï }
        width[ad_index]=$((19+${#ad_text}))
    done
};  ad_plane_text

#‚Üë ‚Üì ‚Üê ‚Üí ‚ñ≤ ‚ñº ‚ñ∂ ‚óÄ ‚ñ∑ ‚óÅ ‚ñ≥ ‚ñΩ
sprite_help () {
    x=$[$endx/2-25/2]
    y=$[$endy/2-5]
    XY $[x+19]  $y                                       '‚ñ≤'
    XY $[x+19] $[y+1]                              "${RED}W$DEF"
    XY  $x     $[y+2] "${BLD}Control with:$DEF  ‚óÄ ${RED}A S D$DEF ‚ñ∂"
    XY $[x+19] $[y+3]                                    '‚ñº'
    XY  $x     $[y+5] "${BLD}Shoot\select with:$DEF ${YLW}P $BLD$red-=$GRN>$DEF"
}

sprite_lose () {
    x=$[$endx/2-25/2] CM1=$BLD$red
    y=$[$endy/2-5]    CM2=$DIM$RED
    XY $x  $y    "$CM1  ____    _    __  __ _____ $DEF"
    XY $x $[y+1] "$red / ___|  / \  |  \/  | ____|$DEF"
    XY $x $[y+2] "$red| | __  / _ \ | |\/| |  _|  $DEF"
    XY $x $[y+3] "$RED| |_\ \/ ___ \| |  | | |___ $DEF"
    XY $x $[y+4] "$CM2 \____/_/   \_\_|__|_|_____|$DEF"
    XY $x $[y+5] "$CM1  / _ \ \   / / ____|  _ \  $DEF"
    XY $x $[y+6] "$red | | | \ \ / /|  _| | |_) | $DEF"
    XY $x $[y+7] "$RED | |_| |\ V / | |___|  _ <  $DEF"
    XY $x $[y+8] "$CM2  \___/  \_/  |_____|_| \_| $DEF"
}

sprite_win () {
    x=$[$endx/2-25/2] CM1=$BLD$grn
    y=$[$endy/2-5]    CM2=$DIM$GRN
    XY $x  $y  "${CM1}__        ______ _    _    $DEF"
    XY $x $[y+1] "$grn\ \      / /____| |  | |   $DEF"
    XY $x $[y+2] "$grn \ \ /\ / /  _| | |  | |   $DEF"
    XY $x $[y+3] "$GRN  \ V  V /| |___| |__| |__ $DEF"
    XY $x $[y+4] "$CM2 __\_/\_/_|_____|____|____|$DEF"
    XY $x $[y+5] "$CM1|  _ \ / _ \| \ | | ____| |$DEF"
    XY $x $[y+6] "$grn| | | | | | |  \| |  _| | |$DEF"
    XY $x $[y+7] "$GRN| |_| | |_| | |\  | |___|_|$DEF"
    XY $x $[y+8] "$CM2|____/ \___/|_| \_|_____(_)$DEF"
}

sprite_tobe () {
    x=10          CM1=$DIM$WHT CM3=$red
    y=$[$endy-10] CM2=$DIM$red CM4=$BLD$YLW CM5=$ylw
    XY $x $[y+1] $CM1'     __ __ _                                                 '$DEF
    XY $x $[y+2] $CM2'   / /________  ___    ___-  ---___ _    ___   __ _     ___  '$DEF
    XY $x $[y+3] $CM3'  ////_  __/_  / /_____  _____ _ __ / /_(_)_ __ _____ _/ /   '$DEF
    XY $x $[y+4] $RED' ///  / /  \  / _  \_ \ / _/_ \  _ \ __/ /_ \/ / /_ \_  /    '$DEF
    XY $x $[y+5] $YLW'/ /  / /(_) |/ /_) |__// (_(_) |// // / / / /_/ / __// /     '$DEF
    XY $x $[y+6] $CM4'\ \ /_/\___//_.___/__/ \___\__///_/_//_/ /_/__,_|__|_,_|_    '$DEF
    XY $x $[y+7] $CM5' \_\____ ______  __   -----------  __________  ----'"$CM1  ______ __"$DEF
}
#------------------------{ And here the story goes... }-----------------------------------------------------------------
the_story(){
    [[ $type == duel ]] && exit
    color="$DEF$BLD$RED" # main color
    story=(
        "$DEF${RED}Our ${color}research team started to observe the debris of alien mothership."
        "${color}But it's already clear that they are came from $DEF${red}Mars.$DEF${RED}.$DEF$DIM${red}."
        ''
        "${color}The research will be continued but we must act quickly."
        "${color}Lets start our $DEF${red}Mars $DEF${RED}mission $DEF$DIM${red}immediately."
        "${color}One famous $DEF${RED}ornithologist ${color}agree to help us with the transport."
        "${color}Prepare all what is needed for this mission at once."
        "${color}The fait of whole $DEF${RED}mankind ${color}is at $DEF${red}stake!$DEF${RED}.$DEF$DIM${red}."
        "${color}Be brave, it could be a one way ticket."
        ''
        ''
        "${color}Go$DEF${red}od $DEF${RED}lu$DEF$DIM${red}ck!.."
        ''
        ''
        "${color}end of transmission"
        "${color}press any $DEF${red}key $DEF${RED}to $DEF$DIM${red}continue "
    )

    clear
    x=3 y=2
    for line in "${story[@]}"; do
        size=${#line}
        for ((i=1; i<=size; i++)); {
            [[ ${line:$((i-1)):3} =~ \\e\[ ]] && ((i+=6))
            XY $x $y "${line:0:i}"
            sleep $storyspd
        }
        ((y++))
    done
    printf "$DEF"
    read   -srn1
    clear
}
#   __ _____ _____                                                                                        _____ _____ __
#   |X\___.-‚ï®‚îÄÔΩ°_                                      - >           <=-                                     _ÔΩ°‚îÄ‚ï®-.___/X|
#   `‚îÄ¬¥‚Äæ‚Äæ‚Ä∑\¬∞‚òÖ ¬∫¬Ø]‚îÄ     ->                                                          <-                     ‚îÄ[¬Ø¬∫ ‚ú†¬∞/‚Ä¥‚Äæ‚Äæ`‚îÄ¬¥
#          ‚Äæ‚Äæ‚Äæ‚Äæ‚Äæ                  -=>          <-                                                           ‚Äæ‚Äæ‚Äæ‚Äæ‚Äæ
#================================================{ Sprites }============================================================
size=($(stty size)) endx=${size[1]} endy=${size[0]} halfx=$[endx/2] halfy=$[endy/2]
case $month in
    0[12]|12) # winter
        SKY=$DEF$bwht         # sky color
        LND=$DEF$BLD$WHT$BWHT # land color
        BRD=200               # birds rnd
        CLD=30                # clouds rnd
        TRE=50;;              # trees rnd

   0[345]) # spring
        SKY=$DEF$blue         # sky color
        LND=$DEF$DIM$grn$BGRN # land color
        BRD=100               # birds rnd
        CLD=50                # clouds rnd
        TRE=50;;              # trees rnd

    0[678]) # summer
        SKY=$DEF$bcyn         # sky color
        LND=$DEF$DIM$GRN$bgrn # land color
        BRD=150               # birds rnd
        CLD=50                # clouds rnd
        TRE=40;;              # trees rnd

    09|1[01]) # autumn
        SKY=$DEF$BCYN         # sky color
        LND=$DEF$DIM$YLW$BGRN # land color
        BRD=100               # birds rnd
        CLD=30                # clouds rnd
        TRE=50;;              # trees rnd
esac
case $game in server) BRD=400 CLD=100 TRE=100;; esac
                              # ‚éï - space
  gun=(‚îÄ ‚îÄ ‚ïê ‚â° ‚â£ ùÑö)
grass=(‚îÇ ' ' ‚ïë ' ' ‚ñë ' ' ‚ñí ' ' ‚ñì ' ' ‚ñà) # grass types
#-------------------{ Generate grass }----------------------------------------------------------------------------------
for ((i=0; i<$endx; i++)); do land+=${grass[$[RANDOM % ${#grass[*]}]]}; done; land+=$land; LN=${#land} landendy=$[endy-2]
#------------------------{ Bonuses }------------------------------------------------------------------------------------
sprite_ammo () {
    case "$day$month$virus" in
        *covid-19)
            mov - && ENM[i]="ammo $OX $OY 3 6 $SC $SM $CS $CL $AS 3 $i" || { unset ENM[i]; return; }
            CM1=$SKY$BLD$red CM2=$SKY$BLU X1="_Y_$[OX+1]H" X2="_Y_$[OX+1]H" 
            #0123456
            #1 _ _  
            #2(_|_) 
            #3(_|_) 
            ####################  1     2   3       4          5  6    #0
            cut $SX  $OY    $CM1 '' $X1'_' ' ' $CM2'_' "$CM2"' '       #1
            cut $SX $[OY+1] $CM1 '('   '_' '|' $CM2'_' "$CM2"')' ' '   #2
            cut $SX $[OY+2] $CM1 '('   '_' '|' $CM2'_' "$CM2"')' ' ';; #3
        *)
            mov - && ENM[i]="ammo $OX $OY 3 4 $SC $SM $CS $CL $AS 3 $i" || { unset ENM[i]; return; }
            CM1=$SKY$BLD$red CM2=$SKY$GRN
            #01234
            #1-=> 
            #2-=> 
            #3-=> 
            ####################  1   2       3   4    #0
            cut $SX  $OY    $CM1 '-' '=' $CM2'>' ' '   #1
            cut $SX $[OY+1] $CM1 '-' '=' $CM2'>' ' '   #2
            cut $SX $[OY+2] $CM1 '-' '=' $CM2'>' ' ';; #3
    esac
}
sprite_life () {
    mov - && ENM[i]="life $OX $OY 3 4 $SC $SM $CS $CL $AS 3 $i" || { unset ENM[i]; return; }
    CM1=$SKY$RED X1="_Y_$[OX+1]H"
    #01234
    #1/V\ 
    #2\ / 
    #3 V  
    ####################  1     2   3    4  #0
    cut $SX  $OY    $CM1 '/'   'V' '\\' ' ' #1
    cut $SX $[OY+1] $CM1 '\\'  ' ' '/'  ' ' #2
    cut $SX $[OY+2] $CM1 '' $X1'V' ' '      #3
}
sprite_gunup () {
    local L=4
    [[ $penis ]] && L=7
    mov - && ENM[i]="gunup $OX $OY 3 $L $SC $SM $CS $CL $AS 3 $i" || { unset ENM[i]; return; }
    CM1=$SKY$BLK CM2=$SKY$blk CM3=$SKY$UND$blk
    case $G:$penis in
          *:?*) #Penis mode)
                CM1=$SKY$DIM$BLU CM2=$DIM$UND$BLU CM3=$SKY$BLD$BLU CM4=$SKY$BLD$UND$BLU
                #012345670
                #1 ____  1
                #2/vgr\\ 2
                #3\999// 3
                ####################  1        2       3       4       5        6        7    #0
                cut $SX  $OY    $CM3 ' '      '_'     '_'     '_'     '_'  $SKY' '            #1
                cut $SX $[OY+1] $CM1 '/'      'v'     'g'     'r'     '\\' $CM4'\\' $SKY' '   #2
                cut $SX $[OY+2] $CM1 '\\' $CM2'9' $CM2'9' $CM2'9' $CM2'/'  $CM3'/'  $SKY' ';; #3
          1:*)  #012340
                #1‚Äñ‚Äî‚Äî 1
                #2‚Äñ   2
                #3‚Äñ‚Äî‚Äî 3
                ####################  1       2       3   4    #0
                cut $SX  $OY    $CM1 '‚Äñ' $CM2'‚Äî' $CM2'‚Äî' ' '   #1
                cut $SX $[OY+1] $CM1 '‚Äñ' $SKY' '               #2
                cut $SX $[OY+2] $CM1 '‚Äñ' $CM2'‚Äî' $CM2'‚Äî' ' ';; #3
          2:*)  #012340
                #1‚Äñ‚Äî‚Äî 1
                #2‚Äñ‚Äî‚Äî 2
                #3‚Äñ‚Äî‚Äî 3
                ####################  1       2       3   4    #0
                cut $SX  $OY    $CM1 '‚Äñ' $CM2'‚Äî' $CM2'‚Äî' ' '   #1
                cut $SX $[OY+1] $CM1 '‚Äñ' $CM2'‚Äî' $CM2'‚Äî' ' '   #2
                cut $SX $[OY+2] $CM1 '‚Äñ' $CM2'‚Äî' $CM2'‚Äî' ' ';; #3
          3:*)  #012340
                #1‚Äñ== 1
                #2‚Äñ   2
                #3‚Äñ== 3
                ####################  1       2       3       4    #0
                cut $SX  $OY    $CM1 '‚Äñ' $CM3'‚Äæ' $CM3'‚Äæ' $SKY' '   #1
                cut $SX $[OY+1] $CM1 '‚Äñ' $SKY' '                   #2
                cut $SX $[OY+2] $CM1 '‚Äñ' $CM3'‚Äæ' $CM3'‚Äæ' $SKY' ';; #3
          *:*)  #012340
                #1‚Äñ== 1
                #2‚Äñ‚Äî‚Äî 2
                #3‚Äñ== 3
                ####################  1       2       3       4    #0
                cut $SX  $OY    $CM1 '‚Äñ' $CM3'‚Äæ' $CM3'‚Äæ' $SKY' '   #1
                cut $SX $[OY+1] $CM1 '‚Äñ' $CM2'‚Äî' $CM2'‚Äî'     ' '   #2
                cut $SX $[OY+2] $CM1 '‚Äñ' $CM3'‚Äæ' $CM3'‚Äæ' $SKY' ';; #3
    esac
}
#------------------------{ Ad plane }-----------------------------------------------------------------------------------
flame1=("$red- ‚éï"       "$ylw~ ‚éï"       "$red- $RED~ ‚éï" "$ylw- ‚éï ‚éï")
flame2=("$ylw- ‚éï"       "$red- $RED~ ‚éï" "$red~ ‚éï ‚éï"       "$YLW~ ‚éï")
flame3=("$red- $RED~ ‚éï" "$red~ ‚éï ‚éï"       "$YLW~ ‚éï"       "$ylw- ‚éï")
sprite_msngr () {
    mov - && BP2[i]="msngr $OX $OY 4 ${width[C1]} $SC $SM $CS $CL $AS $AL $C1" || { unset BP2[i]; return; }
    X1="_Y_$[OX+7]H" X2="_Y_$[OX+1]H" X3="_Y_$[OX+12]H" X4="_Y_$[OX+4]H" X5="_Y_$[OX+12]H"
    CM1=$SKY$BLD$blk CM2=$SKY$DIM$blk CM3=$SKY$blk CM4= CM5= CM6=$BLD$red
    case "$day$month" in 0905) CM4=$bylw CM5=$bblk;; esac
    drop_crate
    #0000000000111111111122222222223333
    #0123456789012345678901234567890123
    #1       __
    #2 _____/_/   +------------------+~
    #3(¬∞_\ |_)---<| Die alien scum! -~
    #4    \|      +-----------------~ 0       0      0        0       0       0   0   1   1   1         1       1       1  ...
    ####################  1       2   3       4      5        6       7       8   9   0   1   2         3       4       5  ...                            #0
    cut $SX  $OY    $CM1 ''      ''  ''      ''     ''       ''      ''   $X1'_' '_' ' '                                                                  #1
    cut $SX $[OY+1] $CM2 ''   $X2'_' '_'     '_'    '_'      '_'     '/'     '_' '/' ' ' ''  '' $X3$CM4'+' $CM4'-' $CM4'-' ${line[C1]}  $SKY${flame1[AS]}  #2
    cut $SX $[OY+2] $CM1 '(' $UND'¬∞' ' ' $CM2'\\'   ' '  $CM3'|' $UND' ' $CM3')' '-' '-' '-' '<'   $CM5'|' $CM5' ' ${new_ad[C1]} $CM5' ' $SKY${flame2[AS]} #3
    cut $SX $[OY+3] $CM2 ''      ''  ''       '' $X4'\\' $CM3'|'     ' '     ''  ''  ''  ''  '' $X5$CM4'+' ${line[C1]} $SKY${flame3[AS]}                   #4
};  msgrendy=$[endy-10]

sprite_crate () {
    movy + && ENM[$i]="crate $OX $OY $OH $OW $SC $SM $CS $CL 0 0 0 0 $i" || { unset ENM[$i]; boom $OX $boomendy; boom $OX $[boomendy-3]; crate=0; }
    CM1=$SKY$ylw CM2=$SKY$blk CM3=$SKY$BLU SS="$RED ? $CM3"
    ########################1234567###01234567
    cuty  $OX    $OY 7 $SKY'       ' #1       
    cuty  $OX    $OY 6 $CM1' ¬∏.‚Äî.¬∏ ' #2 ¬∏.‚Äî.¬∏ 
    cuty  $OX    $OY 5 $CM1'(Ô∏π_Ô∏π)'  #3(Ô∏π_Ô∏π)
    cuty $[OX+1] $OY 4  $CM2'‚ï≤‚ï± ‚ï≤‚ï±'  #4 ‚ï≤‚ï± ‚ï≤‚ï± 
    cuty $[OX+1] $OY 3  $CM3'‚ïî‚ïß‚ï¶‚ïß‚ïó'  #5 ‚ïî‚ïß‚ï¶‚ïß‚ïó 
    cuty $[OX+1] $OY 2  $CM3"‚ï†$SS‚ï£"  #6 ‚ï† ? ‚ï£ 
    cuty $[OX+1] $OY 1  $CM3'‚ïö‚ïê‚ï©‚ïê‚ïù'  #7 ‚ïö‚ïê‚ï©‚ïê‚ïù 
}
#------------------------{ Starship }-----------------------------------------------------------------------------------
sprite_starship () {
    [[ $takeoff ]] && { movy - && eng1=" ${bs1[$AS]}${bs1[$AS]}${bs1[$AS]} " eng2="  ${bs2[$AS]}  " || mess tobe; }
    BP2[$i]="starship $OX $OY $OH $OW $SC $SM $CS $CL $AS $AL 0 0 $i"
    CM1=$SKY$BLD$WHT SB=$bwht; case $month in 0[1-4]|12) CM1=$SKY$DIM$wht SB=$BWHT;; esac
    HS="$S1C$SB$H1S$CM1"
    #####################1234567   567###01234567
    cuty $OX $OY 10 $CM1'   ‚ñÉ   '       #1   ‚ñÉ
    cuty $OX $OY 9  $CM1' ‚óø‚ñû'"$HS"'‚ñô‚ó£ ' #2 ‚óø‚ñû‚òÖ‚ñô‚ó£
    cuty $OX $OY 8  $CM1'  ‚ñë‚ñí‚ñà  '       #3  ‚ñë‚ñí‚ñà
    cuty $OX $OY 7  $CM1'  ‚ñë‚ñí‚ñà  '       #4  ‚ñë‚ñí‚ñà
    cuty $OX $OY 6  $CM1'  ‚ñë‚ñí‚ñà  '       #5  ‚ñë‚ñí‚ñà
    cuty $OX $OY 5  $CM1' ‚ï±‚ñë‚ñí‚ñà‚ï≤ '       #6 ‚ï±‚ñë‚ñí‚ñà‚ï≤
    cuty $OX $OY 4  $CM1'‚îÇ_‚ñë‚ñí‚ñà_‚îÉ'       #7‚îÇ_‚ñë‚ñí‚ñà_‚îÉ
    [[ $takeoff ]] && {
    cuty $OX $OY 3  $RED" $eng1 " #8  ‚†á‚†Ü‚†Å
    cuty $OX $OY 2  $YLW" $eng2 " #9   ‚†Å‚†Ü
    cuty $OX $OY 1  $SKY'       ' #10
    }
}

sprite_exhaust () {
    BX=$OX BY=$OY
    [[ $AS -ge $AL ]] && { unset BP2[i]; return; }  #11111111112222222222333
    case $AS in ###########################012345678901234567890123456789012######################################
          0) cut $[BX+23]  $BY    $RED                          '¬∏.‚Ä¢¬¥¬¥¬Ø`‚Ä¢‚Ä¢.¬∏';; #                      ¬∏.‚Ä¢¬¥¬¥¬Ø`‚Ä¢‚Ä¢.¬∏
          1) cut $[BX+21] $[BY-1] $RED                        '¬∏.‚Ä¢¬¥¬¥¬Ø`‚Ä¢‚Ä¢.¬∏'     #                   ¬∏.‚Ä¢¬¥¬¥¬Ø`‚Ä¢‚Ä¢.¬∏
             cut $[BX+19]  $BY    $RED                      '/           ¬¥¬Ø`';; #                  /           ¬¥¬Ø`
          2) cut $[BX+16] $[BY-1] $red                   '¬∏.‚Ä¢¬¥¬¥¬Ø`‚Ä¢‚Ä¢.¬∏     '     #               ¬∏.‚Ä¢¬¥¬¥¬Ø`‚Ä¢‚Ä¢.¬∏
             cut $[BX+15]  $BY    $red                  '/           ¬¥¬Ø`‚Ä¢‚Ä¢.¬∏';; #              /           ¬¥¬Ø`‚Ä¢‚Ä¢.¬∏
          3) cut $[BX+13] $[BY-2] $DIM$RED            '¬∏. ¬¥¬¥¬Ø`‚Ä¢ .¬∏'             #             ¬∏. ¬¥¬¥¬Ø`‚Ä¢ .¬∏
             cut $[BX+12] $[BY-1] $DIM$RED           '/           ¬¥¬Ø`‚Ä¢ .¬∏'      #            /           ¬¥¬Ø`‚Ä¢ .¬∏
             cut $[BX+12]  $BY    $DIM$RED           '|                   ¬¥¬Ø';; #           |                   ¬¥¬Ø
          4) cut $[BX+13] $[BY-3] $DIM$red            '¬∏ - ‚Äæ ¬¥¬¥‚Äæ` ‚Ä¢ _'          #           ¬∏ - ‚Äæ ¬¥¬¥‚Äæ` ‚Ä¢ _
             cut $[BX+11] $[BY-2] $DIM$red          '/               ¬Ø ¬∏'       #          /               ¬Ø ¬∏
             cut $[BX+10] $[BY-1] $DIM$red         '(                   ¬Ø¬∏'     #         (                   ¬Ø¬∏
             cut $[BX+10]  $BY    $DIM$red         '|                      ¬∏'   #         |                      ¬∏
             BP1[1]= BP1[2]= BP1[3]=
             BP2[0]="torch $[halfx-12] $[endy-5] 3 1 0 $[3+RANDOM%3] 1 1 $[RANDOM%6] 5" # burn
             BP2[1]="torch $[halfx-8 ] $[endy-5] 3 1 0 $[3+RANDOM%3] 1 1 $[RANDOM%6] 5" # sock &
             BP2[2]="torch $[halfx-15] $[endy-5] 3 1 0 $[3+RANDOM%3] 1 1 $[RANDOM%6] 5" # these
             BP2[3]="torch $[halfx-18] $[endy-5] 3 1 0 $[3+RANDOM%3] 1 1 $[RANDOM%6] 5" # trees)
             takeoff=1;;
          5) cut $[BX+13] $[BY-3] $SKY                '              '          #
             cut $[BX+12] $[BY-2] $blk               '¬∏  -  ‚Äæ  ‚Äæ  ‚Ä¢  ¬∏'         #           ¬∏  -  ‚Äæ  ‚Äæ  ‚Ä¢  ¬∏
             cut $[BX+10] $[BY-1] $blk             '/                    ¬∏'     #         /                    ¬∏
             cut $[BX+8]   $BY    $blk           '/                        ¬∏';; #       /                        ¬∏
          6) cut $[BX+11] $[BY-2] $SKY               '                   '      #
             cut $[BX+6]  $[BY-1] $blk          '¬∏   -   ‚Äæ   ‚Äæ   `   ‚Ä¢  ¬∏ '     #      ¬∏   -   ‚Äæ   ‚Äæ   `   ‚Ä¢  ¬∏
             cut $[BX+3]   $BY    $blk       '¬∏                            ¬∏';; #   ¬∏                            ¬∏
          7) cut $[BX+6]  $[BY-1] $SKY          '                        '      #
             cut  $BX      $BY    $blk    '¬∏    -    ‚Äæ    ‚Äæ     `     ‚Ä¢    ¬∏';; #¬∏    -    ‚Äæ    ‚Äæ     `     ‚Ä¢    ¬∏
          8) cut  $BX      $BY    $SKY    '                                 ';; # eraser
    esac
    mov -; BP2[i]="exhaust $BX $BY 0 0 $SC $SM $CS $CL $AS $AL"
}

bulb=("$SKYBLD$WHT." "$SKYBLD$RED.")
sprite_startable () {
    BX=$OX BY=$OY
    mov -; BP3[i]="startable $BX $BY $OH $OW $SC $SM $CS $CL $AS 1"
    CM1=$SKY$BLD$blk$UND CM2=$SKY$BLD$blk CM3=$SKY$YLW
    ###########################00000000011111111
    ###########################12345678901234567####0
    cuty $[BX+13]   $OY 8             ${bulb[$AS]} #1             .
    cuty $[BX+13]   $OY 7              $CM2'‚îÇ'     #2             ‚îÇ
    cuty $[BX+12]   $OY 6             $CM1'‚ï±‚îÉ'     #3         ___‚ï±‚îÉ
    cuty $[BX+9+TM] $OY 5          $CM1'‚îÇ‚ï≥‚îÉ‚ï≥‚îÉ'     #4         ‚îÇ‚ï≥‚îÉ‚ï≥‚îÉ
    cuty $[BX+11]   $OY 4            $CM1'‚îÉ‚ï≥‚îÉ'     #5           ‚îÉ‚ï≥‚îÉ
    cuty $[BX+11]   $OY 3            $CM1'‚îÉ‚ï≥‚îÉ'     #6           ‚îÉ‚ï≥‚îÉ
    cuty $[BX+11]   $OY 2            $CM1'‚îÉ‚ï≥‚îÉ'     #7           ‚îÉ‚ï≥‚îÉ
    cuty  $BX       $OY 1 $CM3'‚ñÇ‚ñÑ‚ñÜ‚ñâ‚ñÄ‚ñâ‚ñÄ‚ñÄ‚ñÄ‚ñâ‚ñÄ‚ñâ‚ñâ‚ñâ‚ñÜ‚ñÑ‚ñÇ'  #8‚ñÇ‚ñÑ‚ñÜ‚ñâ‚ñÄ‚ñâ‚ñÄ‚ñÄ‚ñÄ‚ñâ‚ñÄ‚ñâ‚ñâ‚ñâ‚ñÜ‚ñÑ‚ñÇ
    case  $TM in
        ''|0) cuty $[BX+9+TM]  $OY 6 $CM1'   ';;   #top spaces move
           1) cuty $[BX+9+TM]  $OY 6 $CM1'  '
              cuty $[BX+13+TM] $OY 6 $CM1' '  ;;
           2) cuty $[BX+9+TM]  $OY 6 $CM1' '
              cuty $[BX+12+TM] $OY 6 $CM1'  ' ;;
    esac
}

sprite_lift () {
    BX=$OX BY=$OY BU=$BY BL=$BX
    case $lift in
        ( up  ) mov; ((AS<AL)) && BU=$[BY-AS]        || lift=left   BY=$[BY-AL+1] AS=0;;
        (left ) mov; ((AS<AL)) && BL=$[BX-AS]        || lift=right  BX=$[BX-AL+1] AS=0 AL=3;;
        (right) mov; ((AS<AL)) && BL=$[BX+AS] TM=$AS || lift= ex1=1 BX=$[BX+AL-1] AS=0;;
    esac

    BP4[i]="lift $BX $BY 1 1 $SC $SM 1 1  $AS $AL"
    CM1=$SKY$BLK
    #01
    #1‚ñâ
    ###################### 1  #0
    cut $BL $BU $CM1 '‚ñâ' #1
}

sock=(
  "$WHT= $RED‚â° $WHT‚â° $RED‚â£ $WHT‚â£"
  "$WHT‚â° $RED‚â£ $WHT‚â£ $RED‚â° $WHT‚â°"
  "$WHT‚â£ $RED‚â° $WHT‚â° $RED‚â° $WHT‚â£"
)
sprite_windsock () {
    BX=$OX BY=$OY
    mov -; BP2[i]="windsock $BX $BY 2 8 $SC $SM $CS $CL $AS 2"
    X1="_Y_$[OX+6]H" CM1=$SKY$WHT CM2=$SKY$DIM$WHT
    #01234567
    #1=‚â°‚â°‚â£‚â£>‚îê
    #2      ‚îÇ
    #################### 1  2  3  4  5      6       7  #0
    cut $OX  $OY    $CM1  ${sock[$AS]} $CM2'>' $CM2'‚îê' #1
    cut $OX $[OY+1] $CM2 '' '' '' '' ''    ''   $X1'‚îÇ' #2
}

#‚†Å‚†Ç‚†É‚†Ñ‚†Ö‚†Ü‚†á‚†à‚†â‚†ê‚†ë‚†í‚†ì‚†î‚†ï‚†ñ‚†ó‚†ò‚†ô‚††‚†°‚†¢‚†£‚†§‚†•‚†¶‚†ß‚†®‚†©‚†∞‚†±‚†≤‚†≥‚†¥‚†µ‚†∂‚†∑‚†∏‚†π‚°Ä‚°Å‚°Ç‚°É‚°Ñ‚°Ö‚°Ü‚°á‚°à‚°â‚°ê‚°ë‚°í‚°ì‚°î‚°ï‚°ñ‚°ó‚°ò‚°ô‚°†‚°°‚°¢‚°£‚°§‚°•‚°¶‚°ß‚°®‚°©‚°∞‚°±‚°≤‚°≥‚°¥‚°µ‚°∂‚°∑‚°∏‚°π‚¢Ä‚¢Å‚¢Ç‚¢É‚¢Ñ‚¢Ö‚¢Ü‚¢á‚¢à‚¢â‚¢ê‚¢ë‚¢í‚¢ì‚¢î‚¢ï‚¢ñ‚¢ó‚¢ò‚¢ô
bs1=('‚éï' '‚éï' '‚°Ä' '‚†Ü' '‚†á' '‚†Ç' '‚éï')
bs2=('‚†Ü' '‚†á' '‚†É' '‚†Å' '‚éï' '‚éï' '‚†Ñ')
sprite_torch () {
    BX=$OX BY=$OY
    mov -; BP2[i]="torch $BX $BY 3 1 $SC $SM $CS $CL $AS 6"
    CM1=$SKY$DIM$BLK CM2=$SKY$BLD$RED CM3=$SKY$BLD$YLW
    #01
    #1‚°Ä
    #2‚†É
    #3‚îÇ
    ####################      1      #0
    cut $BX  $OY    $CM3 ${bs1[$AS]} #1
    cut $BX $[OY+1] $CM2 ${bs2[$AS]} #2
    cut $BX $[OY+2] $CM1     '‚îÇ'     #3
}
#------------------------{ Bird }---------------------------------------------------------------------------------------
# ‚åÑ _ 
#     ^
sprite_bird () {
    mov - && BP1[i]="bird $OX $OY 2 2 $SC $SM $CS $CL $AS $AL" || { unset BP1[i]; return; }
    case $AS in
          0) cut $SX  $OY    $SKY$blk '‚åÑ' ' '
             cut $SX $[OY+1] $SKY     ' ' ' ';;
          1) cut $SX  $OY    $SKY$blk '_' ' '
             cut $SX $[OY+1] $SKY     ' ' ' ';;
          2) cut $SX  $OY    $SKY     ' ' ' '
             cut $SX $[OY+1] $SKY$blk '^' ' ';;
    esac
}
#------------------------{ BOOM }---------------------------------------------------------------------------------------
boomendx=$[endx-10]
boomendy=$[endy-4 ]
sprite_boom () {
    BX=$OX BY=$OY
    [[ $AS -ge $AL ]] && { unset BP3[i]; return; }
    case $AS in
          0) cut $[BX+3]  $BY    $YLW         '_'      #     _
             cut $[BX+2] $[BY+1] $YLW        '(_)';;   #    (_)
          1) cut $[BX+2]  $BY    $RED        '.-.'     #    .-.
             cut $[BX+1] $[BY+1] $RED       '(   )'    #   (   )
             cut $[BX+1] $[BY+2] $RED        '`-¬¥';;   #    `-¬¥
          2) cut $[BX+3] $[BY-1] $red         '_'      #     _
             cut $[BX+1]  $BY    $red       '-   +'    #   -   +
             cut  $BX    $[BY+1] $red      '(     )'   #  (     )
             cut $[BX+1] $[BY+2] $red       '+ _ -';;  #   + _ -
          3) cut $[BX+2] $[BY-1] $DIM$RED    '- -'     #    - -
             cut  $BX     $BY    $DIM$RED  '¬¥     `'   #  ¬¥     `
             cut $[BX-1] $[BY+1] $DIM$RED "'       '"  # '       '
             cut  $BX    $[BY+2] $DIM$RED  '`  _  ¬¥';; #  `  _  ¬¥
          4) cut $[BX+2] $[BY-1] $SKY        '   '     #  eraser
             cut  $BX     $BY    $SKY      '       '   #
             cut $[BX-1] $[BY+1] $SKY     '         '  #
             cut  $BX    $[BY+2] $SKY      '       ';; #
    esac
    mov -; BP3[i]="boom $BX $BY 0 0 $SC $SM $CS $CL $AS $AL"
}
#------------------------{ Sun }----------------------------------------------------------------------------------------
Sunsendx=$[endx-18]
sprite_Sun () {
    mov -; BP1[i]="Sun $Sunsendx 1 9 18 $SC 7 $CS $CL $AS $AL"
    case $AS in
          0) cut $OX 1 $SKY$YLW     '       ___ |       '
             cut $OX 2 $SKY$BLD$YLW '---````    \       '
             cut $OX 3 $SKY$YLW     '           _`.     '
             cut $OX 4 $SKY$BLD$YLW '        ../   `..__'
             cut $OX 5 $SKY$YLW     '     ../        /  '
             cut $OX 6 $SKY$YLW     '    /          /   '
             cut $OX 7 $SKY$BLD$YLW '              /    '
             cut $OX 8 $SKY$YLW     '              /    '
             cut $OX 9 $SKY$BLD$YLW '             /     ';;
          1) cut $OX 1 $SKY$YLW     '_...---``  |       '
             cut $OX 2 $SKY$BLD$YLW '        _.-\       '
             cut $OX 3 $SKY$YLW     '   _.--`    `.     '
             cut $OX 4 $SKY$YLW     ' -`          ,`..__'
             cut $OX 5 $SKY$BLD$YLW '           ,`     |'
             cut $OX 6 $SKY$YLW     '         ,`       |'
             cut $OX 7 $SKY$YLW     '       _`        | '
             cut $OX 8 $SKY$BLD$YLW '                 | '
             cut $OX 9 $SKY$YLW     '                 | ';;
          2) cut $OX 1 $SKY$BLD$YLW '     _...--|       '
             cut $OX 2 $SKY$BLD$YLW '..--`      \       '
             cut $OX 3 $SKY$BLD$YLW '         .. `.     '
             cut $OX 4 $SKY$YLW     '     _.-`     `..__'
             cut $OX 5 $SKY$BLD$YLW '  ..`         .`   '
             cut $OX 6 $SKY$BLD$YLW '             /     '
             cut $OX 7 $SKY$YLW     '            /      '
             cut $OX 8 $SKY$BLD$YLW '          .`       '
             cut $OX 9 $SKY$YLW     '         `         ';;
    esac
}
#------------------------{ Intro }--------------------------------------------------------------------------------------
sprite_PIU () {
    [[ $OX -gt $C1 ]] && mov - || return 1
    INT[i]="PIU $OX $OY 9 41 $SC $SM $CS $CL $AS $AL $C1"
    C1=$DEF$BLU C2=$RED C3=$YLW C4=$red C5=$BLD$BLU X1="_Y_$[OX+1]H" X2="_Y_$[OX+2]H" X3="_Y_$[OX+3]H" X4="_Y_$[OX+6]H$C2"
    XC=$X3$C2
    #00000000001111111111222222222233333333334
    #01234567890123456789012345678901234567890
    #1   ‚ñë   ‚ñë‚ñë‚ñë ‚ñë‚ñë     ‚ñë  ‚ñë‚ñë      ‚ñë‚ñë  ‚ñë‚ñë ‚ñë   
    #2 ‚ñë   ‚ñë  ‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñë‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñí‚ñà‚ñà‚ñë  ‚ñí‚ñà‚ñà      
    #3   ‚ñë ‚ñë‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà ‚ñì‚ñì‚ñì‚ñà‚ñà‚ñì ‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà‚ñë‚ñë ‚ñë  
    #4‚ñë ‚ñë ‚ñë‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà ‚ñí‚ñí‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñë     
    #5      ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë ‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà‚ñë‚ñë ‚ñë ‚ñë 
    #6  ‚ñë  ‚ñí‚ñì‚ñà‚ñà‚ñì‚ñì‚ñì‚ñì  ‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñë‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñë     
    #7   ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñë ‚ñë ‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë ‚ñë    
    #8‚ñë ‚ñë‚ñí‚ñì‚ñì‚ñì‚ñì ‚ñë ‚ñë‚ñë‚ñí‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì ‚ñë ‚ñí‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë          
    #9 ‚ñë ‚ñí‚ñí ‚ñë ‚ñë ‚ñë ‚ñë‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí ‚ñë ‚ñë‚ñë‚ñí‚ñí‚ñí‚ñí‚ñë  ‚ñë  0    0    0    0    0    0    1 1    1    1    1    1    1    1    1    1    2    2    2    2    2    2    2    2    2    2    3    3    3    3    3    3 3 3 3 3 4
    ###################  1    2    3    4    5    6    7    8    9    0 1    2    3    4    5    6    7    8    9    0    1    2    3    4    5    6    7    8    9    0    1    2    3    4    5 6 7 8 9 0 #0
    cut $SX  $OY    $C1 ''   ''   '' $X3‚ñë    ‚éï    ‚éï    ‚éï    ‚ñë    ‚ñë    ‚ñë ‚éï    ‚ñë    ‚ñë    ‚éï    ‚éï    ‚éï    ‚éï    ‚éï    ‚ñë    ‚éï    ‚éï    ‚ñë    ‚ñë    ‚éï    ‚éï    ‚éï    ‚éï    ‚éï    ‚éï    ‚ñë    ‚ñë    ‚éï    ‚éï    ‚ñë    ‚ñë ‚éï ‚ñë ‚éï     #1
    cut $SX $[OY+1] $C1 '' $X1‚ñë    ‚éï    ‚éï    ‚éï    ‚ñë    ‚éï    ‚éï $C2‚ñí $C3‚ñà ‚ñà    ‚ñà    ‚ñà    ‚ñà    ‚ñà    ‚éï $C1‚ñë $C2‚ñí $C3‚ñà    ‚ñà    ‚ñà    ‚ñà    ‚ñà    ‚ñà    ‚éï $C2‚ñí $C3‚ñà    ‚ñà $C1‚ñë    ‚éï    ‚éï $C2‚ñí $C3‚ñà    ‚ñà    ‚éï           #2
    cut $SX $[OY+2] $C1 ''   ''   '' $X3‚ñë    ‚éï    ‚ñë    ‚ñë $C2‚ñí $C4‚ñì $C3‚ñà ‚ñà    ‚éï $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà    ‚éï $C4‚ñì    ‚ñì    ‚ñì $C3‚ñà    ‚ñà $C4‚ñì    ‚éï $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà    ‚éï $C1‚ñë $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà $C1‚ñë ‚ñë ‚éï ‚ñë ‚éï   #3
    cut $SX $[OY+3] $C1  ‚ñë    ‚éï    ‚ñë    ‚éï    ‚ñë    ‚ñë $C2‚ñí $C4‚ñì $C3‚ñà $C3‚ñà ‚éï $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà    ‚éï $C2‚ñí    ‚ñí    ‚ñí $C4‚ñì $C3‚ñà    ‚ñà    ‚éï $C1‚ñë $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà $C1‚ñë    ‚éï $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà $C1‚ñë ‚éï         #4
    cut $SX $[OY+4] $C5 ''   ''   ''   ''   ''   '' $X4‚ñí $C4‚ñì $C3‚ñà    ‚ñà ‚ñà    ‚ñà    ‚ñà    ‚ñà $C5‚ñë    ‚éï    ‚ñë $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà    ‚éï $C5‚ñë $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà    ‚éï $C5‚ñë $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà $C5‚ñë    ‚ñë ‚éï ‚ñë ‚éï ‚ñë ‚éï #5
    cut $SX $[OY+5] $C1 ''   '' $X2‚ñë    ‚éï    ‚éï $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà $C4‚ñì ‚ñì    ‚ñì    ‚ñì    ‚éï    ‚éï $C1‚ñë    ‚éï $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà $C1‚ñë    ‚éï $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà $C1‚ñë    ‚ñë $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà    ‚éï $C1‚ñë ‚éï         #6
    cut $SX $[OY+6] $C1 ''   ''   '' $XC‚ñí $C4‚ñì $C3‚ñà    ‚ñà    ‚ñà    ‚ñà $C2‚ñí ‚ñí    ‚ñí $C1‚ñë    ‚éï    ‚ñë    ‚éï $C4‚ñì $C3‚ñà    ‚ñà    ‚ñà    ‚ñà    ‚ñà    ‚ñà    ‚éï $C2‚ñí $C4‚ñì $C3‚ñà    ‚ñà    ‚ñà    ‚ñà    ‚ñà    ‚ñà $C1‚ñë    ‚ñë    ‚éï ‚ñë ‚éï       #7
    cut $SX $[OY+7] $C1  ‚ñë    ‚éï    ‚ñë $C2‚ñí $C4‚ñì    ‚ñì    ‚ñì    ‚ñì    ‚éï $C1‚ñë ‚éï    ‚ñë    ‚ñë $C2‚ñí $C4‚ñì    ‚ñì    ‚ñì    ‚ñì    ‚ñì    ‚ñì    ‚éï $C1‚ñë    ‚éï $C2‚ñí $C4‚ñì    ‚ñì    ‚ñì    ‚ñì    ‚ñì $C1‚ñë    ‚éï                               #8
    cut $SX $[OY+8] $C1 '' $X1‚ñë    ‚éï    ‚ñí    ‚ñí    ‚éï    ‚ñë    ‚éï    ‚ñë    ‚éï ‚ñë    ‚éï    ‚ñë    ‚ñí    ‚ñí    ‚ñí    ‚ñí    ‚ñí    ‚ñí    ‚éï    ‚ñë    ‚éï    ‚ñë    ‚ñë    ‚ñí    ‚ñí    ‚ñí    ‚ñí    ‚ñë    ‚éï    ‚éï    ‚ñë    ‚éï                     #9
}
sprite_ARR () {
    [[ $OX -lt $C1 ]] && mov + || return 1
    INT[i]="ARR $OX $OY 6 28 $SC $SM $CS $CL $AS $AL $C1"
    C1=$DEF$blu C2=$DEF$DIM$mgn C3=$DEF$BLD$GRN C4=$DEF$DIM$red C5=$DEF$BLD$RED C6=$DEF$BLD$YLW
    X1="_Y_$[OX+1]H" X2="_Y_$[OX+4]H" X3="_Y_$[OX+5]H" X4="_Y_$[OX+10]H"
    #00000000001111111111222222222
    #01234567890123456789012345678
    #1           ‚ñë‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñë        
    #2      ‚ñë‚ñë‚ñë ‚ñí‚ñà‚ñà‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñë      
    #3  ‚ñë ‚ñí‚ñà‚ñà‚ñà‚ñà‚ñí‚ñì‚ñì‚ñì‚ñì ‚ñë‚ñë‚ñí‚ñì‚ñì‚ñà‚ñà‚ñà ‚ñë‚ñë ‚ñë
    #4 ‚ñë ‚ñí‚ñì‚ñì‚ñì‚ñì ‚ñí‚ñà‚ñà‚ñà‚ñà‚ñë‚ñí‚ñì‚ñà‚ñà‚ñà‚ñë‚ñë      
    #5  ‚ñí ‚ñí‚ñí  ‚ñí‚ñì‚ñì‚ñì‚ñì‚ñí‚ñì‚ñà‚ñà‚ñà‚ñë         
    #6     ‚ñë‚ñë‚ñë ‚ñí‚ñí‚ñí ‚ñë‚ñë‚ñí‚ñí‚ñë 0    0 0    0    0    0    0    0    0    1    1    1    1    1    1    1    1    1    1    2    2    2    2 2    2 2 2 2
    ###################  1    2 3    4    5    6    7    8    9    0    1    2    3    4    5    6    7    8    9    0    1    2    3 4    5 6 7 8 #0
    cut $SX  $OY    $C1 ''   '' ''  ''   ''   ''   ''   ''   ''   '' $X4‚éï    ‚ñë    ‚ñë    ‚éï $C6‚ñí    ‚ñì $C3‚ñà $C3‚ñà $C3‚ñà $C1‚ñë                             #1
    cut $SX $[OY+1] $C1 ''   '' ''  ''   '' $X3‚éï    ‚ñë    ‚ñë    ‚ñë    ‚éï $C2‚ñí $C5‚ñà $C5‚ñà $C5‚ñà $C5‚ñà    ‚éï $C6‚ñí $C6‚ñì $C3‚ñà $C3‚ñà $C3‚ñà $C1‚ñë                   #2
    cut $SX $[OY+2] $C1 '' $X1‚éï ‚ñë    ‚éï $C4‚ñí $C5‚ñà $C5‚ñà $C5‚ñà $C5‚ñà $C4‚ñí $C2‚ñì $C2‚ñì $C2‚ñì $C2‚ñì    ‚éï $C1‚ñë $C1‚ñë $C6‚ñí $C6‚ñì $C6‚ñì $C3‚ñà $C3‚ñà $C3‚ñà ‚éï $C1‚ñë ‚ñë ‚éï ‚ñë #3
    cut $SX $[OY+3] $C1  ‚éï    ‚ñë ‚éï $C2‚ñí $C2‚ñì $C2‚ñì $C2‚ñì $C2‚ñì    ‚éï $C4‚ñí $C5‚ñà $C5‚ñà $C5‚ñà $C5‚ñà $C1‚ñë $C6‚ñí $C6‚ñì $C3‚ñà $C3‚ñà $C3‚ñà $C1‚ñë    ‚ñë                   #4
    cut $SX $[OY+4] $C1 '' $X1‚éï ‚ñí    ‚éï    ‚ñí    ‚ñí    ‚éï    ‚éï $C2‚ñí $C2‚ñì $C2‚ñì $C2‚ñì $C2‚ñì $C6‚ñí $C6‚ñì $C3‚ñà $C3‚ñà $C3‚ñà $C1‚ñë                                  #5
    cut $SX $[OY+5] $C1 ''   '' ''  '' $X2‚éï    ‚ñë    ‚ñë    ‚ñë    ‚éï    ‚ñí    ‚ñí    ‚ñí    ‚éï    ‚ñë    ‚ñë    ‚ñí    ‚ñí    ‚ñë                                       #6
}
#------------------------{ Hero1 }--------------------------------------------------------------------------------------
#                                                   center.point
mainrotor=("${blk}_ ${blk}_ ${blk}_ ${blk}_ ${blk}_       ‚éï ${blk}_ ${blk}_ ${blk}_ ${blk}_ ${blk}_"  # '_____ _____'
           "      ‚éï       ‚éï       ‚éï ${blk}_ ${blk}_ ${blk}_ ${blk}_ ${blk}_       ‚éï       ‚éï       ‚éï"  # '   _____   '
           "      ‚éï       ‚éï       ‚éï       ‚éï ${blk}_       ‚éï ${blk}_       ‚éï       ‚éï       ‚éï       ‚éï"  # '    _ _    '
           "      ‚éï       ‚éï       ‚éï ${blk}_ ${blk}_ ${blk}_ ${blk}_ ${blk}_       ‚éï       ‚éï       ‚éï") # '   _____   '

tailrotor=("$blk|" "$blk/" "$blk‚îÄ" $blk'\\') # '|' '/' '‚îÄ' '\'
heroendx=$((endx-15))
heroendy=$((endy-8 ))
[[ $virus ]] && DHS=‚ò¢ DHC=$RED DSC=$YLW

sprite_hero1 () {
    mov - || { unset HER[i];  return; }
    [[ $1 ]] || control_hero1 $H1X $H1Y
    if [[ $life -gt 0 ]]; then
       CS=1 CL=16 OX=$H1X OY=$H1Y
    else # when hero's health goes to 0 it starts to fall, explodes and bounces on the ground
       AS=0 SM=3  #spd=0.1
       [[ $OY -lt $TY ]] && ((OY++))  || { TY=$[heroendy-C2+2]; ((C2--)); }
       [[ $OY -gt $TY ]] && ((OY--))  ||   TY=$[heroendy+2]
       [[ $OX -gt -10 && $C1 -eq 0 ]] && { BOOM $SX $[OY-2]; C1=15; }
       screen+="\\e[$[endy-1];$[OX+OW]H$LND "
    fi

    case $type in
     'duel')
         re="crate ($[OX+7]|$[OX+8]|$[OX+9]|$[OX+10]|$[OX+11]) ($[OY+2]|$[OY+3]|$[OY+4]|$[OY+5]|$[OY+6]).*";;
     'team')
         re="(life|ammo|gunup) ($[OX+12]|$[OX+13]) ($[OY+1]|$[OY+2]|$[OY+3]|$[OY+4]).*|"
        re+="alien ($[OX+12]|$[OX+13]) ($[OY+1]|$[OY+2]).*|"
        re+="bfire ($[OX+12]|$[OX+13]) ($[OY+2]|$[OY+3]).*|"
        re+="boss ($[OX+12]|$[OX+13]) $[OY-1].*";;
    esac
    CM1=$SKY$H1C$BLD CM2=$SKY$DIM$H1C CM3=$SKY$H1C CM4=$SKY$BLD$H1C$UND TR=${tailrotor[AS]} X1="_Y_$[OX+6]H" HS=$BLD$S1C$H1S
    GN=$SKY$BLD$BLK${gun[$G]}; [[ $G -eq 5 ]] && GN=$SKY$BLD$BLK${gun[$G]}
    #00000000001111111
    #01234567890123456                                                                                                             ___
    #1                                                 ‚ñà‚ñì‚ñí‚ñë                           ___                                        _/ o \_
    #2 __ _____ _____                                         ___                    (  o)                                      /O   O  \
    #3 |X\___.-‚ï®‚îÄÔΩ°_                     -=>                  ( o )                    `¬Ø¬¥            ‚ñà‚ñì‚ñí‚ñë     ___              (   O    O)
    #4 `‚îÄ¬¥‚Äæ‚Äæ‚Ä∑\¬∞‚òÖ ¬∫¬Ø]-         - >                      ->     `¬Ø¬¥                                            (o  )              `¬Ø¬Ø---¬Ø¬Ø¬¥
    #5        ‚Äæ‚Äæ‚Äæ‚Äæ‚Äæ                                                                                           `¬Ø¬¥
    #6                    0   0   0       0        0       0       0       0        0       1        1       1       1       1   1   1
    ######X####Y#####CLR  1   2   3       4        5       6       7       8        9       0        1       2       3       4   5   6  #0
    cut $SX  $OY    $SKY ' ' ' ' ' '     ' '      ' '     ' '     ' '     ' '      ' '     ' '      ' '     ' '     ' '     ' ' ' ' ' ' #1
    cut $SX $[OY+1] $CM1 ' ' '_' '_'     ' '                                         ${mainrotor[AS]}                               ' ' #2
    cut $SX $[OY+2] $CM2 ' ' '|' $TR $CM1'\\' $CM1'_' $CM1'_' $CM1'_' $CM3'.'  $CM3'-' $CM3'‚ï®'  $CM4'‚îÄ' $CM4'ÔΩ°' $CM1'_' $SKY' ' ' ' ' ' #3
    cut $SX $[OY+3] $CM2 ' ' '`' '‚îÄ'     '¬¥'      '‚Äæ'     '‚Äæ'     '‚Ä∑'     '\\' $blk'¬∞'     $HS  $SKY' ' $blk'¬∫' $blk'¬Ø' $CM1']' $GN ' ' #4
    cut $SX $[OY+4] $CM2 ' ' ' ' ' '     ' '      ' '     ' '     ' '     ' '      '‚Äæ'     '‚Äæ'      '‚Äæ'     '‚Äæ'     '‚Äæ' $SKY' ' ' ' ' ' #5
    cut $SX $[OY+5] $SKY ''  ''  ''      ''       ''      ''   $X1' '     ' '      ' '     ' '      ' '     ' '     ' '     ' '         #6
    [[  $C1 -gt 0 ]]  && ((C1--))
    collision 1 "$re" && { BOOM $OX $OY; ((life--)); }
    HER[i]="hero1 $OX $OY 6 16 $SC $SM $CS $CL $AS $AL $C1 $C2"
}

sprite_hero2 () {
    mov - || { unset HER[i]; return; }
    if [[ $life2 -gt 0 ]]; then
        CS=1 CL=16 OX=$H2X OY=$H2Y
    else # when heros health goes to 0 it starts to fall, explodes and bounces on the ground
        AS=0 SM=3 H2Y=
        [[ $OY -lt $TY ]] && ((OY++))  || { TY=$[heroendy-C2+2]; ((C2--)); }
        [[ $OY -gt $TY ]] && ((OY--))  ||   TY=$[heroendy+2]
        [[ $OX -gt -10 && $C1 -eq 0 ]] && { BOOM $SX $[OY-2]; C1=15; }
        screen+="\\e[$[endy-1];$[OX+OW]H$LND "
    fi

    sp=' '; ((G2>4)) && sp='„ÄÄ'
    CM1=$SKY$H2C$BLD CM2=$SKY$DIM$H2C CM3=$SKY$H2C CM4=$SKY$BLD$H2C$UND TR=${tailrotor[AS]} GN=$SKY$BLD$BLK${gun[$G2]}
    case $type in
     'duel') control_hero2 $[H2X-10] $H2Y
             re="crate ($[OX-4]|$[OX-3]|$[OX-2]|$[OX-1]|$OX) ($[OY+2]|$[OY+3]|$[OY+4]|$[OY+5]|$[OY+6]).*"
             X1="_Y_$[OX+2]H"; [[ $G2 -eq 5 ]] && GN=$SKY$BLD$BLK‚éï${gun[$G2]}
             #00000000001111111
             #01234567890123456
             #1
             #2 _____ _____ __
             #3   _ÔΩ°‚îÄ‚ï®-.___/X|
             #4 ‚îÄ[¬Ø¬∫ ‚ú†¬∞/‚Ä¥‚Äæ‚Äæ`‚îÄ¬¥
             #5   ‚Äæ‚Äæ‚Äæ‚Äæ‚Äæ
             #6                    0   0       0       0       0       0       0        0       0       1   1   1   1   1       1   1
             ####################  1   2       3       4       5       6       7        8       9       0   1   2   3   4       5   6  #0
             cut $SX  $OY    $SKY ' ' ' '     ' '     ' '     ' '     ' '     ' '      ' '     ' '     ' ' ' ' ' ' ' ' ' '     ' ' ' ' #1
             cut $SX $[OY+1] $CM1 "$sp"                                 ${mainrotor[AS]}                       ' ' $CM1'_'     '_' ' ' #2
             cut $SX $[OY+2] $CM1 ' ' ' '     "$sp"   '_' $CM4'ÔΩ°'     '‚îÄ' $CM3'‚ï®'      '-'     '.' $CM1'_' '_' '_' '/' $TR $CM1'|' ' ' #3
             cut $SX $[OY+3] $CM2 ' ' $GN $CM2'[' $blk'¬Ø' $blk'¬∫' $SKY' ' $S2C$H2S $blk'¬∞' $CM2'/'     '‚Ä∑' '‚Äæ' '‚Äæ' '`' '‚îÄ'     '¬¥' ' ' #4
             cut $SX $[OY+4] $CM2 ' ' ' '     "$sp"   '‚Äæ'     '‚Äæ'     '‚Äæ'     '‚Äæ'      '‚Äæ'     ' '     ' ' ' ' ' ' ' ' ' '     ' ' ' ' #5
             cut $SX $[OY+5] $SKY ''  ''   $X1' '     ' '     ' '     ' '     ' '      ' '     ' ';;                                   #6

     'team') control_hero2 $H2X $H2Y
              X1="_Y_$[OX+6]H"; [[ $G2 -eq 5 ]] && GN=$SKY$BLD$BLK${gun[$G2]}
              re="(life|ammo|gunup) ($[OX+12]|$[OX+13]) ($[OY+1]|$[OY+2]|$[OY+3]|$[OY+4]).*|"
             re+="alien ($[OX+12]|$[OX+13]) ($[OY+1]|$[OY+2]).*|"
             re+="bfire ($[OX+12]|$[OX+13]) ($[OY+2]|$[OY+3]).*|"
             re+="boss ($[OX+12]|$[OX+13]) $[OY-1].*"
             #00000000001111111
             #01234567890123456
             #1
             #2 __ _____ _____                                                                                                       _____ _____ __
             #3 |X\___.-‚ï®‚îÄÔΩ°_                                                  - >           <=-                                        _ÔΩ°‚îÄ‚ï®-.___/X|
             #4 `‚îÄ¬¥‚Äæ‚Äæ‚Ä∑\¬∞‚òÖ ¬∫¬Ø]‚îÄ     ->                                                                         <-                     ‚îÄ[¬Ø¬∫ ‚ú†¬∞/‚Ä¥‚Äæ‚Äæ`‚îÄ¬¥
             #5        ‚Äæ‚Äæ‚Äæ‚Äæ‚Äæ                        -=>                <-                                                              ‚Äæ‚Äæ‚Äæ‚Äæ‚Äæ
             #6                    0   0   0       0        0       0       0       0        0       1        1       1       1       1   1   1
             ####################  1   2   3       4        5       6       7       8        9       0        1       2       3       4   5   6  #0
             cut $SX  $OY    $SKY ' ' ' ' ' '     ' '      ' '     ' '     ' '     ' '      ' '     ' '      ' '     ' '     ' '     ' ' ' ' ' ' #1
             cut $SX $[OY+1] $CM1 ' ' '_' '_'     ' '                                         ${mainrotor[AS]}                               ' ' #2
             cut $SX $[OY+2] $CM2 ' ' '|' $TR $CM1'\\' $CM1'_' $CM1'_' $CM1'_' $CM3'.'  $CM3'-' $CM3'‚ï®'  $CM4'‚îÄ' $CM4'ÔΩ°' $CM1'_' $SKY' ' ' ' ' ' #3
             cut $SX $[OY+3] $CM2 ' ' '`' '‚îÄ'     '¬¥'      '‚Äæ'     '‚Äæ'     '‚Ä∑'     '\\' $blk'¬∞' $S2C$H2S $SKY' ' $blk'¬∫' $blk'¬Ø' $CM1']' $GN ' ' #4
             cut $SX $[OY+4] $CM2 ' ' ' ' ' '     ' '      ' '     ' '     ' '     ' '      '‚Äæ'     '‚Äæ'      '‚Äæ'     '‚Äæ'     '‚Äæ' $SKY' ' ' ' ' ' #5
             cut $SX $[OY+5] $SKY ''  ''  ''      ''       ''      ''   $X1' '     ' '      ' '     ' '      ' '     ' '     ' '     ' ';;       #6
    esac

    [[ $C1 -gt 0  ]] && ((C1--))
    collision 2 "$re" && { BOOM $OX $OY; ((life2--)); }
    HER[i]="hero2 $OX $OY 6 16 $SC $SM $CS $CL $AS $AL $C1 $C2"
}
#------------------------{ Shoots }-------------------------------------------------------------------------------------
shoot=(
    "        ‚éï     $RED-"   #  ->
    "$BLD$red- $BLD$red="   # -=>
    "    $red=     $red-"   # =->
    "    $RED-         ‚éï")  # - >
bullendx=$[endx-4]

sprite_piu1 () {
    case $type in
         'duel') re="${ht}2 ($OX|$[OX+1]) ($[OY-1]|$[OY-2]|$[OY-3]|$[OY-4]).*";;
         'team') re="alien ($OX|$[OX+1]) $[OY-1].*|boss ($OX|$[OX+1]) ($[OY-2]|$[OY-3]|$[OY-4]).*";;
    esac
    mov + && PIU[i]="piu1 $OX $OY 1 4 $SC $SM $CS $CL $AS 3" || { unset PIU[i]; return; }
    case "$day:$month:$virus" in
          *:*:covid-19)
            #0123
            #1 ==
            ################  1       2       3    #0
            cut $OX $OY $SKY ' ' $RED'=' $BLU'=';; #1
          *)
            CM1=$SKY$BLD$GRN
            #01234
            #1 -=>
            ################  1      2    3        4    #0
            cut $OX $OY $SKY ' ' ${shoot[AS]} $CM1'>';; #1
    esac
    collision 1 "$re" $OX $[OY-1] && unset PIU[i]
}

sprite_piu2 () {
    case $type in
         'duel')  direction='-' re="${ht}1 ($[OX-10]|$[OX-11]) ($[OY-1]|$[OY-2]|$[OY-3]|$[OY-4]).*";;
         'team')  direction='+' re="alien ($OX|$[OX+1]) $[OY-1].*|boss ($OX|$[OX+1]) ($[OY-2]|$[OY-3]|$[OY-4]).*";;
    esac
    mov $direction && PIU[i]="piu2 $OX $OY 1 4 $SC $SM $CS $CL $AS 3" || { unset PIU[i]; return; }
    case "$day:$month:$virus:$type" in
          *:*:*:duel)
            CM1=$SKY$BLD$BLU
            #01234
            #1<=-
            ################  1      2    3       4   #0
            cut $SX $OY $CM1 '<' ${shoot[AS]} $SKY‚éï;; #1
          *:*:covid-19:*)
            #0123
            #1 ==
            ################  1       2       3    #0
            cut $OX $OY $SKY ' ' $RED'=' $BLU'=';; #1
          *)
            CM1=$SKY$BLD$BLU
            #01234
            #1 -=>
            ################  1      2    3        4    #0
            cut $OX $OY $SKY ' ' ${shoot[AS]} $CM1'>';; #1
    esac
    collision 2 "$re" $OX $[OY-1] && unset PIU[i]
}
bshoot=('‚ñà ‚ñì ‚ñí ‚ñë'
        '‚ñì ‚ñí ‚ñë ‚ñí'
        '‚ñí ‚ñë ‚ñí ‚ñì'
        '‚ñë ‚ñí ‚ñì ‚ñà'
        '‚ñí ‚ñì ‚ñà ‚ñì'
        '‚ñì ‚ñà ‚ñì ‚ñí')
sprite_bfire () {
    CM1=$SKY$BLD$ylw
    mov - && ENM[i]="bfire $OX $OY 1 5 $SC $SM $CS $CL $AS 5 $i" || { unset ENM[i]; return; }
    #012345
    #1‚ñà‚ñì‚ñí‚ñë
    ################ 1   2   3   4  5  #0
    cut $SX $OY $CM1 ${bshoot[AS]} ' ' #1
}
#------------------------{ Aliens }-------------------------------------------------------------------------------------
small=("${SKY}‚éï  ${SKY}‚éï  ${RED}o"
       "${SKY}‚éï  ${RED}o  ${SKY}‚éï"
       "${RED}o  ${SKY}‚éï  ${SKY}‚éï"
       "${SKY}‚éï  ${SKY}‚éï  ${SKY}‚éï")
enmyendy=$[endy-9 ]
CM1=$SKY$UND$BLD$grn
pumtop=( "$CM1"'\\' "$CM1"'\\' "$CM1|" "$CM1|" "$CM1/" "$CM1/")
pumface=("${RED}O ${RED}‚Ä¶ ${RED}o"
         "${RED}‚Ä¶ ${RED}o       ‚éï"
         "${RED}o       ‚éï ${RED}O"
         "      ‚éï       ‚éï       ‚éï$CM1"
         "      ‚éï       ‚éï ${RED}O"
         "      ‚éï ${RED}O ${RED}‚Ä¶")

top1=("$RED." "$RED," "$RED'" "$RED'")
top2=("$RED'" "$RED'" "$RED." "$RED,")
mid1=("$RED-" "$RED+" "$RED'" "$RED'")
mid2=("$RED+" "$RED'" "$RED'" "$RED-")
bot1=($RED'¬¥'  $RED'"' $RED'`' $RED'"')
bot2=($RED'"'  $RED'`' $RED'"' $RED'¬¥')
cen=("$RED"o  "$RED+" "$RED*" "$RED+")

sprite_alien () {
    case "$day$month$virus" in
        3110)
            mov - && ENM[i]="alien $OX $OY 3 5 $SC $SM $CS $CL $AS 5 $i" || { unset ENM[i]; ((enumber--)); return; }
            CM1=$SKY$BLD$ylw CM2=$SKY$UND$DIM$grn CM3=$SKY$ylw X1="_Y_$[OX+1]H" X2="_Y_$[OX+1]H"
            #0123456
            #1 _\_
            #2(O‚Ä¶o)
            #3 `¬Ø¬¥
            ####################  1     2        3            4   5   6  #0
            cut $SX  $OY    $CM1 '' $X1'_' ${pumtop[AS]} $CM1'_' ' '     #1
            cut $SX $[OY+1] $CM1 '('       ${pumface[AS]}  "$CM1"')' ' ' #2
            cut $SX $[OY+2] $CM1 '' $X2'`'      '¬Ø'          '¬¥' ' ';;   #3
        *covid-19)
            mov - && ENM[i]="alien $OX $OY 3 5 $SC $SM $CS $CL $AS 3 $i" || { unset ENM[i]; ((enumber--)); return; }
            CM1=$SKY$DIM$BLK X1="_Y_$[OX+1]H" X2="_Y_$[OX+1]H"
            #0123456
            #1 ._,
            #2-(*)-
            #3 ¬¥‚Äæ`
            ####################  1           2         3          4    5          6  #0
            cut $SX  $OY    $CM1 '' $X1${top1[AS]} $CM1'_' ${top2[AS]} ' '            #1
            cut $SX $[OY+1] $CM1 ${mid1[AS]} '(' ${cen[AS]} "$CM1"')' ${mid2[AS]} ' ' #2
            cut $SX $[OY+2] $CM1 '' $X2${bot1[AS]} $CM1'‚Äæ' ${bot2[AS]} ' ';;          #3
        *)
            mov - && ENM[i]="alien $OX $OY 3 5 $SC $SM $CS $CL $AS 3 $i" || { unset ENM[i]; ((enumber--)); return; }
            CM1=$SKY$DIM$BLK CM2=$BLD$BLK X1="_Y_$[OX+1]H" X2="_Y_$[OX+1]H"
            #0123456
            #1 ___
            #2( o )
            #3 `¬Ø¬¥
            ####################  1     2       3       4    5   6  #0
            cut $SX  $OY    $CM1 '' $X1'_' $CM2'_' $CM1'_'  ' '     #1
            cut $SX $[OY+1] $CM1 '('     ${small[AS]} "$CM1"')' ' ' #2
            cut $SX $[OY+2] $CM1 '' $X2'`'     '¬Ø'     '¬¥'  ' ';;   #3
    esac
}

big1=("      ‚éï       ‚éï ${YLW}O           ‚éï       ‚éï       ‚éï ${YLW}O"
      "      ‚éï       ‚éï       ‚éï $BLD${YLW}O       ‚éï       ‚éï       ‚éï"
      "${YLW}O       ‚éï       ‚éï           ‚éï ${YLW}O       ‚éï       ‚éï"
      "      ‚éï ${YLW}O       ‚éï           ‚éï       ‚éï ${YLW}O       ‚éï")

big2=("      ‚éï ${BLU}O       ‚éï           ‚éï       ‚éï ${BLU}O       ‚éï"
      "${BLU}O       ‚éï       ‚éï           ‚éï ${BLU}O       ‚éï       ‚éï"
      "      ‚éï       ‚éï       ‚éï $BLU${BLD}O       ‚éï       ‚éï       ‚éï"
      "      ‚éï       ‚éï ${BLU}O           ‚éï       ‚éï       ‚éï ${BLU}O")

big3=("    ‚éï $RED*       ‚éï     ‚éï       ‚éï $RED+     ‚éï"
      "$RED+     ‚éï       ‚éï     ‚éï ${RED}o     ‚éï     ‚éï"
      "    ‚éï     ‚éï       ‚éï $RED+       ‚éï     ‚éï     ‚éï"
      "    ‚éï     ‚éï ${RED}o     ‚éï       ‚éï     ‚éï $RED+")

big4=("      ‚éï     ‚éï $RED*     ‚éï     ‚éï       ‚éï $RED+"
      "      ‚éï     ‚éï     ‚éï $RED+     ‚éï       ‚éï     ‚éï"
      "${RED}o     ‚éï     ‚éï     ‚éï $RED*       ‚éï     ‚éï"
      "      ‚éï $RED*     ‚éï     ‚éï     ‚éï ${RED}o     ‚éï")

mouthtop=("${RED}/ ${RED}V ${RED}V ${RED}V ${RED}V ${RED}V $RED"'\\'
          "${RED}/ ${RED}v ${RED}v ${RED}v ${RED}v ${RED}v $RED"'\\'
          "${RED}. ${RED}- ${RED}- ${RED}- ${RED}- ${RED}- ${RED}."
          "      ‚éï       ‚éï       ‚éï       ‚éï       ‚éï       ‚éï       ‚éï"
          "${RED}. ${RED}- ${RED}- ${RED}- ${RED}- ${RED}- ${RED}."
          "${RED}/ ${RED}v ${RED}v ${RED}v ${RED}v ${RED}v ${RED}"'\\'
          "${RED}/ ${RED}V ${RED}V ${RED}V ${RED}V ${RED}V ${RED}"'\\')

mouthlow=("${RED}V   ${RED}v ${RED}v ${RED}v ${RED}v ${RED}v ${RED}V"
          "${RED}V   ${RED}^ ${RED}^ ${RED}^ ${RED}^ ${RED}^ ${RED}V"
          ${RED}'`'" ${RED}¬Ø ${RED}¬Ø ${RED}¬Ø ${RED}¬Ø ${RED}¬Ø ${RED}¬¥"
          "      ‚éï   ${RED}‚Äæ ${RED}‚Äæ ${RED}‚Äæ ${RED}‚Äæ ${RED}‚Äæ       ‚éï"
          ${RED}'`'" ${RED}- ${RED}- ${RED}- ${RED}- ${RED}- ${RED}¬¥"
          "${RED}V   ${RED}^ ${RED}^ ${RED}^ ${RED}^ ${RED}^ ${RED}V"
          "${RED}V   ${RED}v ${RED}v ${RED}v ${RED}v ${RED}v ${RED}V")

bossendx=$[endx-14]
bossendy=$[endy-7 ]
bosshbar=$[endx-10]

TX=$halfx TY=$bossendy
sprite_boss () {
    [[ $H2Y ]] && HY=$[H2Y-1] || HY=$[H1Y-1] # kill client first
    if [[ $bhealth -gt 0 ]]; then
        #-{ Boss fire }--------------------------------------------------------
        [[ $OY -eq $HY && $C1 -eq 0 ]] && { ENM+=("bfire $[OX-4] $[OY+4] 1 5 0 0 1 5 $[RANDOM%5] 5 ${#ENM[@]}"); C1=20; }
        #-{ Boss move }--------------------------------------------------------
        [[ $OY -lt $HY ]] && ((OY++))
        [[ $OY -gt $HY ]] && ((OY--)) # this is a black magic
        [[ $OX -gt $TX ]] && mov - || { TX=$bossendx; SX=$OX; }
        [[ $OX -lt $TX ]] && mov + || { TX=$halfx   ; SX=$OX; }
        #-{ Aliens out }-------------------------------------------------------
        EX=$[OX+2] EY=$[OY+5]; [[ $EY -gt $[enmyendy+3] ]] && EY=$[enmyendy+3]
    else # when boss' health goes to 0 it starts to fall, explodes and bounces on the ground
        bhealth=0; AS=0; SM=3;   mov - || the_end=win
        [[ $OY -lt $TY ]] && ((OY++))  || { TY=$[bossendy-C2]; ((C2--)); }
        [[ $OY -gt $TY ]] && ((OY--))  ||   TY=$bossendy
        [[ $OX -gt -10 && $C1 -eq 0 ]] && { BOOM $OX $OY; C1=15; }
    fi
    [[ $C1 -gt 0 ]] && ((C1--))
    case "$day$month$virus" in
        3110*)
            CM1=$SKY$BLD$ylw CM2=$SKY$BLD$RED EYE="$CM2( $CM2‚Åê $CM2)"
            X1="_Y_$[OX+1]H" X2="_Y_$[OX+1]H" X3="_Y_$[OX+1]H" X4="_Y_$[OX+2]H"
            #00000000001111
            #01234567890123
            #1
            #2   .-./.-.
            #3  /(_) (_)\
            #4 ‚ù≤ /VVVVV\ ‚ù≥
            #5  \VvvvvvV/
            #6   `¬Ø---¬Ø¬¥
            #7                    0     0     0   0   0   0         0           0   0   1   1       1   1
            ####################  1     2     3   4   5   6         7           8   9   0   1       2   3  #0
            cut $SX  $OY    $SKY '' $X1' '   ' ' ' ' ' ' ' '       ' '         ' ' ' ' ' ' ' '     ' '     #1
            cut $SX $[OY+1] $CM1 '' $X2' '   ' ' '.' '-' '.' ${pumtop[AS]} $CM1'.' '-' '.' ' '     ' ' ' ' #2
            cut $SX $[OY+2] $CM1 ' '   ' '   '/'    $EYE           ' '            $EYE $CM1'\\'    ' ' ' ' #3
            cut $SX $[OY+3] $CM1 ' '   '‚ù≤'   ' '           ${mouthtop[AS]}                 ' ' $CM1'‚ù≥' ' ' #4
            cut $SX $[OY+4] $CM1 ' '   ' '   '\\'          ${mouthlow[AS]}             $CM1'/'     ' ' ' ' #5
            cut $SX $[OY+5] $CM1 '' $X3' '   ' ' '`' '¬Ø' '-'       '-'         '-' '¬Ø' '¬¥' ' '     ' '     #6
            cut $SX $[OY+6] $SKY ''    '' $X4' ' ' ' ' ' ' '       ' '         ' ' ' ' ' ' ' '             #7
            ENM[i]="boss $OX $OY 6 14 $SC $SM $CS $CL $AS 6 $C1 $C2";;
        *covid-19)
            CM1=$SKY$DIM$BLK CM2=$BLD$BLK X1="_Y_$[OX+2]H" X2="_Y_$[OX+2]H" X3="_Y_$[OX+1]H" X4="_Y_$[OX+1]H"
            #00000000001111
            #01234567890123
            #1
            #2   . ___,
            #3   /`   `\
            #4 +| *   o |+
            #5  \   +   /
            #6  *`-.,.-`+
            #7                    0        0      0        0           0   0   0   0       0       1       1       1       1
            ####################  1        2      3        4           5   6   7   8       9       0       1       2       3  #0
            cut $SX  $OY    $SKY ''       ''  $X1' '      ' '         ' ' ' ' ' ' ' '     ' '     ' '     ' '                 #1
            cut $SX $[OY+1] $CM1 ''       ''  $X2' '  ${top2[AS]} $CM1' ' '_' '_' '_' ${top1[AS]} ' '     ' '                 #2
            cut $SX $[OY+2] $CM1 ' '      ' '    ' '      '/'         '`' ' ' ' ' ' '     '`'     '\\'    ' '     ' '     ' ' #3
            cut $SX $[OY+3] $CM1 ' ' ${mid2[AS]} '|'                  ${big3[AS]}                     $CM1'|' ${mid1[AS]} ' ' #4
            cut $SX $[OY+4] $CM1 ' '      ' '    '\\'                 ${big4[AS]}                     $CM1'/'     ' '     ' ' #5
            cut $SX $[OY+5] $CM1 ''    $X3' ' ${bot2[AS]} $CM1'`'     '-' '.' ',' '.'     '-'     '`' ${bot1[AS]} ' '         #6
            cut $SX $[OY+6] $SKY ''    $X4' '    ' '      ' '         ' ' ' ' ' ' ' '     ' '     ' '     ' '     ' '         #7
            ENM[i]="boss $OX $OY 7 13 $SC $SM $CS $CL $AS 3 $C1 $C2";;
        *)
            CM1=$SKY$DIM$BLK CM2=$BLD$BLK X1="_Y_$[OX+4]H" X2="_Y_$[OX+2]H" X3="_Y_$[OX+1]H" X4="_Y_$[OX+1]H"
            #00000000001111
            #01234567890123
            #1
            #2     ___
            #3   _/   \_
            #4  /       \
            #5 (         )
            #6  `¬Ø¬Ø---¬Ø¬Ø¬¥
            #7                    0     0     0   0     0    0   0   0       0    1   1         1   1
            ####################  1     2     3   4     5    6   7   8       9    0   1         2   3  #0
            cut $SX  $OY    $SKY ''    ''    ''  '' $X1' '  ' ' ' ' ' '     ' '                        #1
            cut $SX $[OY+1] $CM2 ''    '' $X2' ' ' '   ' '  '_' '_' '_'     ' '  ' ' ' '               #2
            cut $SX $[OY+2] $CM1 '' $X3' '   ' ' '_'   '/' ${small[AS]} $CM2'\\' '_' ' '       ' '     #3
            cut $SX $[OY+3] $CM1 ' '   ' '   '/'            ${big1[AS]}          $CM2'\\'      ' ' ' ' #4
            cut $SX $[OY+4] $CM1 ' '   '('   ' '            ${big2[AS]}              ' ' "$CM2"')' ' ' #5
            cut $SX $[OY+5] $CM1 ' '   ' '   '`' '¬Ø'   '¬Ø'  '-' '-' '-'     '¬Ø'  '¬Ø' '¬¥'       ' ' ' ' #6
            cut $SX $[OY+6] $SKY '' $X4' '   ' ' ' '   ' '  ' ' ' ' ' '     ' '  ' ' ' '       ' '     #7
            ENM[i]="boss $OX $OY 6 14 $SC $SM $CS $CL $AS $AL $C1 $C2";;
    esac
}
#------------------------{ Clouds }-------------------------------------------------------------------------------------
case $month in
    0[1-4]|12) C1C=$SKY$DIM$CYN;; # winter & early spring
    0[5-8]   ) C1C=$SKY$DIM$WHT;; # late spring & summer
    09|1[0-1]) C1C=$SKY$blk    ;; # autumn
esac
sprite_cloud1 () {
    mov - && BP1[i]="cloud1 $OX $OY 3 6 $SC $SM $CS $CL $AS $AL" || { unset BP1[i]; return; }
    X1="_Y_$[OX+1]H" X2="_Y_$[OX+1]H"
    #01234567
    #1 ,-+.
    #2(    )
    #3 `+-¬¥
    ####################  1     2   3   4   5   6   7  #0
    cut $SX  $OY    $C1C '' $X1',' '-' '+' '.' ' '     #1
    cut $SX $[OY+1] $C1C '('   ' ' ' ' ' ' ' ' ')' ' ' #2
    cut $SX $[OY+2] $C1C '' $X2'`' '+' '-' '¬¥' ' '     #3
}

case $month in
    0[1-4]|12) C2C=$SKY$CYN;; # winter & early spring
    0[5-8]   ) C2C=$SKY$WHT;; # late spring & summer
    09|1[0-1]) C2C=$SKY$BLK;; # autumn
esac
sprite_cloud2 () {
    mov - && BP2[i]="cloud2 $OX $OY 3 8 $SC $SM $CS $CL $AS $AL" || { unset BP2[i]; return; }
    X1="_Y_$[OX+1]H" X2="_Y_$[OX+1]H"
    #0123456789
    #1 ,-._..
    #2(      )
    #3 `-...¬¥
    ####################  1     2   3   4   5   6   7   8   9  #0
    cut $SX  $OY    $C2C '' $X1',' '-' '.' '_' '.' '.' ' '     #1
    cut $SX $[OY+1] $C2C '('   ' ' ' ' ' ' ' ' ' ' ' ' ')' ' ' #2
    cut $SX $[OY+2] $C2C '' $X2'`' '-' '.' '.' '.' '¬¥' ' '     #3
}

case $month in
    0[1-4]|12) C3C=$SKY$BLD$CYN;; # winter & early spring
    0[5-8]   ) C3C=$SKY$BLD$WHT;; # late spring & summer
    09|1[0-1]) C3C=$SKY$DIM$BLK;; # autumn
esac
sprite_cloud3 () {
    mov - && BP3[i]="cloud3 $OX $OY 3 11 $SC $SM $CS $CL $AS $AL" || { unset BP3[i]; return; }
    X1="_Y_$[OX+1]H" X2="_Y_$[OX+1]H"
    #0000000000111
    #0123456789012
    #1 ,+¬Ø`.-¬Ø`.
    #2(         )
    #3 `--.,,.-¬¥          0     0   0   0   0   0   0   0   0   1   1   1
    ####################  1     2   3   4   5   6   7   8   9   0   1   2  #0
    cut $SX  $OY    $C3C '' $X1',' '+' '¬Ø' '`' '.' '-' '¬Ø' '`' '.' ' '     #1
    cut $SX $[OY+1] $C3C '('   ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ')' ' ' #2
    cut $SX $[OY+2] $C3C '' $X2'`' '-' '-' '.' ',' ',' '.' '-' '¬¥' ' '     #3
}
#------------------------{ House }--------------------------------------------------------------------------------------
# ‚ïå ‚ïç ‚îÄ ‚îÅ ‚îÑ ‚îÖ ‚îà ‚îâ ‚ïê ‚ï¥‚ï∂ ‚ï∏‚ï∫ ‚ïº ‚ïæ ‚ï≤ ‚ïµ ‚ï∑ ‚ïπ ‚ïª ‚ïΩ ‚ïø ‚îÇ ‚îÉ ‚ïé ‚ïè ‚îÜ ‚îá ‚îä ‚îã ‚ï∞ ‚ï± ‚îå ‚îç ‚îé ‚îè ‚îê ‚îë ‚îí ‚îì ‚îî ‚îï ‚îñ ‚îó ‚îò ‚îô ‚îö ‚îõ ‚îú ‚îù ‚îû ‚îü ‚î† ‚î° ‚î¢ ‚î£ ‚î§ ‚î• ‚î¶ ‚îß
# ‚î® ‚î© ‚î™ ‚î´ ‚î¨ ‚î≠ ‚îÆ ‚îØ ‚î± ‚î≤ ‚î≥ ‚î¥ ‚îµ ‚î∂ ‚î∑ ‚î∏ ‚îπ ‚î∫ ‚îª ‚îº ‚îΩ ‚îæ ‚îø ‚ïÄ ‚ïÅ ‚ïÇ ‚ïÉ ‚ïÑ ‚ïÖ ‚ïÜ ‚ïá ‚ïà ‚ïâ ‚ïä ‚ïã ‚ïë ‚ïí ‚ïì ‚ïî ‚ïï ‚ïñ ‚ïó ‚ïò ‚ïô ‚ïö ‚ïõ ‚ïú ‚ïù ‚ïü ‚ï† ‚ï° ‚ï¢ ‚ï£ ‚ï§ ‚ï• ‚ï¶ ‚ïß ‚ï® ‚ï©
sprite_house1 () { #                          ‚ñï ‚ï™ ‚ï´ ‚ï¨ ‚ï≠ ‚ïÆ ‚ïØ ‚ñÄ ‚ñÅ ‚ñÇ ‚ñÉ ‚ñÑ ‚ñÖ ‚ñÜ ‚ñá ‚ñà ‚ñâ ‚ñä ‚ñã ‚ñå ‚ñç ‚ñé ‚ñè‚ñê ‚ñë ‚ñí ‚ñì ‚ñî ‚ññ‚ñó ‚ñò ‚ñô ‚ñö ‚ñõ ‚ñú ‚ñù ‚ñû ‚ñü
    mov - && BP1[i]="house1 $OX $OY 2 6 $SC $SM $CS $CL $AS $AL" || { unset BP1[i]; return; }
    CM1=$SKY$DIM$GRN CM2=$SKY$blk
    #0123456
    #1‚ñÅ‚ñÇ‚ñÉ‚ñÇ‚ñÅ
    #2‚îÇ‚ñò‚ñù‚ñù|
    ####################  1   2   3   4   5   6  #0
    cut $SX  $OY    $CM1 '‚ñÅ' '‚ñÇ' '‚ñÉ' '‚ñÇ' '‚ñÅ' ' ' #1
    cut $SX $[OY+1] $CM2 '‚îÇ' '‚ñò' '‚ñù' '‚ñù' '|' ' ' #2
};  hos1endy=$[endy-4]

sprite_house2 () {
    mov - && BP2[i]="house2 $OX $OY 9 30 $SC $SM $CS $CL $AS $AL" || { unset BP2[i]; return; }
    CM1="$SKY$BLU" CM2=$SKY$BLD$YLW CM3=$SKY$YLW CM4=$SKY$ylw CM5=$SKY$blk
    X1="_Y_$[OX+9]H" X2="_Y_$[OX+9]H" X3="_Y_$[OX+8]H" X4="_Y_$[OX+8]H"
    X5="_Y_$[OX+7]H" X6="_Y_$[OX+7]H" X7="_Y_$[OX+6]H" X8="_Y_$[OX+6]H"
    #0000000000111111111122222222223
    #0123456789012345678901234567890
    #1         ‚ïÇ
    #2         ‚ïß
    #3        ‚ï± ‚ï≤
    #4        |‚ñê|
    #5       ‚îÆ‚î∑‚îÅ‚î∑‚î≠
    #6       ‚îÇ ‚ñà |
    #7      ‚îÆ‚î∑‚îÅ‚îÅ‚îÅ‚î∑‚î≠
    #8      ‚îÇ ‚ñõ‚ñî‚ñú ‚îÇ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÇ‚ñÅ
    #9‚ñÇ ‚ï¨ ‚ñÉ ‚îÉ ‚ñå‚ñí‚ñê ‚îÉ ‚ñò‚ñó‚ñò‚îø‚îÉ‚ñó ‚ïÇ ‚ï™ ‚ñÑ  ‚ññ   0   0   0     0     0     0     1   1   1   1       1       1       1       1       1       1   2   2   2   2   2   2   2   2   2   2   3
    ####################  1   2   3   4   5   6     7     8     9     0   1   2   3       4       5       6       7       8       9   0   1   2   3   4   5   6   7   8   9   0  #0
    cut $SX  $OY    $CM2 ''  ''  ''  ''  ''  ''    ''    ''    '' $X1'‚ïÇ' ' '                                                                                                     #1
    cut $SX $[OY+1] $CM3 ''  ''  ''  ''  ''  ''    ''    ''    '' $X2'‚ïß' ' '                                                                                                     #2
    cut $SX $[OY+2] $CM4 ''  ''  ''  ''  ''  ''    ''    '' $X3'‚ï±'   ' ' '‚ï≤' ' '                                                                                                 #3
    cut $SX $[OY+3] $CM5 ''  ''  ''  ''  ''  ''    ''    '' $X4'|'   '‚ñê' '|' ' '                                                                                                 #4
    cut $SX $[OY+4] $CM1 ''  ''  ''  ''  ''  ''    '' $X5'‚îÆ'   '‚î∑'   '‚îÅ' '‚î∑' '‚î≠' ' '                                                                                             #5
    cut $SX $[OY+5] $CM5 ''  ''  ''  ''  ''  ''    '' $X6'‚îÇ'   ' '   '‚ñà' ' ' '‚îÇ' ' '                                                                                             #6
    cut $SX $[OY+6] $CM1 ''  ''  ''  ''  ''  '' $X7'‚îÆ'   '‚î∑'   '‚îÅ'   '‚îÅ' '‚îÅ' '‚î∑' '‚î≠'     ' '                                                                                     #7
    cut $SX $[OY+7] $CM5 ''  ''  ''  ''  ''  '' $X8'‚îÇ'   ' '   '‚ñõ'   '‚ñî' '‚ñú' ' ' '‚îÇ' $CM1'‚ñÑ' $CM1'‚ñÑ' $CM1'‚ñÑ' $CM1'‚ñÑ' $CM1'‚ñÇ' $CM1'‚ñÅ' ' '                                         #8
    cut $SX $[OY+8] $CM5 '‚ñÇ' ' ' '‚ï¨' ' ' '‚ñÉ' ' '   '‚îÉ'   ' '   '‚ñå'   '‚ñí' '‚ñê' ' ' '‚îÉ'     ' '     '‚ñò'     '‚ñó'     '‚ñò'     '‚îø'     '‚îÉ' '‚ñó' ' ' '‚ïÇ' ' ' '‚ï™' ' ' '‚ñÑ' ' ' ' ' '‚ññ' ' ' #9
};  hos2endy=$[endy-11]

sprite_house3 () {
    mov - && BP3[i]="house3 $OX $OY 4 17 $SC $SM $CS $CL $AS $AL" || { unset BP3[i]; return; }
    CM1=$SKY$DIM$MGN CM2=$SKY$blk CM3=$SKY$DIM$CYN X1="_Y_$[OX+5]H" X2="_Y_$[OX+2]H" X3="_Y_$[OX+2]H"
    #0000000000111111111
    #0123456789012345678
    #1     ‚ññ
    #2  ‚ñÇ‚ñÑ‚ñÜ‚ñà‚ñà‚ñÜ‚ñÑ‚ñÇ
    #3  ‚îÉ‚ïí‚ïï‚ïí‚ïï‚ïí‚ïï‚îÉ ‚îÆ‚îÅ‚î≠
    #4‚ï†‚ï¨‚îÉ‚îµ‚îò‚îµ‚î∂‚îî‚î∂‚îÉ‚ï¨‚ï£‚ñì‚ï†‚ï¨‚ï£‚ññ   0   0       0       0       0       0       0       0       0   1       1   1       1       1   1   1       1   1
    ####################  1   2       3       4       5       6       7       8       9   0       1   2       3       4   5   6       7   8  #0
    cut $SX  $OY    $CM2 ''  ''      ''      ''      ''   $X1'‚ññ'     ' '                                                                     #1
    cut $SX $[OY+1] $CM1 ''  ''   $X2'‚ñÇ'     '‚ñÑ'     '‚ñÜ'     '‚ñà'     '‚ñà'     '‚ñÜ'     '‚ñÑ' '‚ñÇ'     ' '                                         #2
    cut $SX $[OY+2] $CM2 ''  ''   $X3'‚îÉ'     '‚ïí'     '‚ïï'     '‚ïí'     '‚ïï'     '‚ïí'     '‚ïï' '‚îÉ'     ' ' '‚îÆ'     '‚îÅ'     '‚î≠' ' '                 #3
    cut $SX $[OY+3] $CM3 '‚ï†' '‚ï¨' $CM2'‚îÉ' $CM2'‚îµ' $CM2'‚îò' $CM2'‚îµ' $CM2'‚î∂' $CM2'‚îî' $CM2'‚î∂' '‚îÉ' $CM3'‚ï¨' '‚ï£' $CM2'‚ñì' $CM3'‚ï†' '‚ï¨' '‚ï£' $CM2'‚ññ' ' ' #4
};  hos3endy=$[endy-6 ]
#------------------------{ Trees }--------------------------------------------------------------------------------------
case $month in
    0[12]|12) T1C=$SKY$DIM$WHT;; # winter
    0[345]  ) T1C=$SKY$DIM$grn;; # spring
    0[678]  ) T1C=$SKY$DIM$GRN;; # summer
    09|1[01]) T1C=$SKY$DIM$YLW;; # autumn
esac;         tre1endy=$[endy-5]
sprite_tree1 () {
    case $month in
        12|0[12])
            mov - && BP1[i]="tree1 $OX $OY 3 3 $SC $SM $CS $CL $AS $AL" || { unset BP1[i]; return; }
            CM1="$SKY$DIM$blk" X1="_Y_$[OX+1]H"
            #01234
            #1 |/
            #2\|
            #3 |
            ####################  1        2   3   4  #0
            cut $SX  $OY    $T1C ''    $X1'|' '/' ' ' #1
            cut $SX $[OY+1] $T1C '\\' $CM1'|' ' '     #2
            cut $SX $[OY+2] $CM1 ''    $X1'|' ' ';;   #3
        0[345]|09|1[01])
            mov - && BP1[i]="tree1 $OX $OY 3 3 $SC $SM $CS $CL $AS $AL" || { unset BP1[i]; return; }
            CM1="$SKY$DIM$blk" X1="_Y_$[OX+1]H"
            #01234
            #1 _
            #2\|/
            #3 |
            ####################  1        2       3    4  #0
            cut $SX  $OY    $T1C ''    $X1'_'     ' '      #1
            cut $SX $[OY+1] $T1C '\\' $CM1'|' $T1C'/'  ' ' #2
            cut $SX $[OY+2] $CM1 ''    $X1'|'     ' ';;    #3
        *)
            mov - && BP1[i]="tree1 $OX $OY 3 3 $SC $SM $CS $CL $AS $AL" || { unset BP1[i]; return; }
            CM1="$SKY$DIM$blk" X1="_Y_$[OX+1]H"
            #01234
            #1/‚Äæ\
            #2\|/
            #3 |
            ####################  1        2       3    4  #0
            cut $SX  $OY    $T1C '/'      '‚Äæ'     '\\' ' ' #1
            cut $SX $[OY+1] $T1C '\\' $CM1'|' $T1C'/'  ' ' #2
            cut $SX $[OY+2] $CM1 ''    $X1'|'     ' ';;    #3
    esac
}

case $month in
    0[12]|12) T2C=$SKY$WHT;; # winter
    0[345]  ) T2C=$SKY$grn;; # spring
    0[678]  ) T2C=$SKY$GRN;; # summer
    09|1[01]) T2C=$SKY$YLW;; # autumn
esac;         tre2endy=$[endy-7]
sprite_tree2 () {
    case $month in
        12|0[12])
            mov - && BP2[i]="tree2 $OX $OY 5 5 $SC $SM $CS $CL $AS $AL" || { unset BP2[i]; return; }
            X1="_Y_$[OX+1]H" X2="_Y_$[OX+2]H" X3="_Y_$[OX+3]H"
            #0123456
            #1   |_
            #2\||/
            #3 \‚ïë|_
            #4  ‚ïë/
            #5  ‚ïë
            ####################  1     2        3       4   5   6  #0
            cut $SX  $OY    $T2C ''    ''       ''   $X3'|' '_' ' ' #1
            cut $SX $[OY+1] $T2C '\\'  '|'  $blk'|'     '/' ' '     #2
            cut $SX $[OY+2] $blk '' $X1'\\'     '‚ïë' $T2C'|' '_' ' ' #3
            cut $SX $[OY+3] $blk ''    ''    $X2'‚ïë'     '/' ' '     #4
            cut $SX $[OY+4] $blk ''    ''    $X2'‚ïë'     ' ';;       #5
        0[345]|09|1[01])
            mov - && BP2[i]="tree2 $OX $OY 5 5 $SC $SM $CS $CL $AS $AL" || { unset BP2[i]; return; }
            X1="_Y_$[OX+1]H"
            #0123456
            #1/‚Äæ\
            #2\|/
            #3 ‚ïë/‚Äæ\
            #4 ‚ïë/_/
            #5 ‚ïë
            ####################  1        2       3       4   5    6  #0
            cut $SX  $OY    $T2C '/'      '‚Äæ'     '\\'    ' '          #1
            cut $SX $[OY+1] $T2C '\\' $blk'|' $T2C'/'     ' '          #2
            cut $SX $[OY+2] $blk ''    $X1'‚ïë' $T2C'/'     '‚Äæ' '\\' ' ' #3
            cut $SX $[OY+3] $blk ''    $X1'‚ïë'     '/' $T2C'_' '/'  ' ' #4
            cut $SX $[OY+4] $blk ''    $X1'‚ïë'     ' ';;                #5
        *)
            mov - && BP2[i]="tree2 $OX $OY 5 5 $SC $SM $CS $CL $AS $AL" || { unset BP2[i]; return; }
            X1="_Y_$[OX+1]H" X2="_Y_$[OX+2]H"
            #0123456
            #1/‚Äæ‚Äæ‚Äæ\
            #2\ | /
            #3 \‚ïë/\
            #4  ‚ïë_/
            #5  ‚ïë
            ####################  1     2        3       4       5    6  #0
            cut $SX  $OY    $T2C '/'   '‚Äæ'      '‚Äæ'     '‚Äæ'     '\\' ' ' #1
            cut $SX $[OY+1] $T2C '\\'  ' '  $blk'|'     ' ' $T2C'/'  ' ' #2
            cut $SX $[OY+2] $T2C '' $X1'\\' $blk'‚ïë' $T2C'/' $T2C'\\' ' ' #3
            cut $SX $[OY+3] $blk ''    ''    $X2'‚ïë' $T2C'_' $T2C'/'  ' ' #4
            cut $SX $[OY+4] $blk ''    ''    $X2'‚ïë'     ' ';;            #5
    esac
}

case $month in
    0[12]|12) T3C=$SKY$BLD$cyn;; # winter
    0[345]  ) T3C=$SKY$DIM$grn;; # spring
    0[678]  ) T3C=$SKY$GRN    ;; # summer
    09|1[01]) T3C=$SKY$DIM$red;; # autumn
esac;         tre3endy=$[endy-10]
sprite_tree3 () {
    case "$day:$month" in
        [23][0-9]:12|0[1-9]:01|10:01)
            mov - && BP3[i]="tree3 $OX $OY 8 12 $SC $SM $CS $CL $AS $AL" || { unset BP3[i]; return; }
            X2="_Y_$[OX+2]H" X4="_Y_$[OX+4]H" X6="_Y_$[OX+6]H"
            #00000000001111
            #01234567890123
            #1      ‚òÖ
            #2    _‚ùÖ|‚óè
            #3    -/‚óã\‚ùÑ-
            #4    ‚óè/|\\‚óã
            #5  _/‚ùÑ/‚óè\‚ùÖ\
            #6  ‚óã///|\‚ùÑ\‚óè
            #7_/‚ùÖ/‚óè/|‚óã\‚ùÖ\-
            #8      ‚ïë             0   0         0       0          0       0       0       0        0        1        1    1   1
            ####################  1   2         3       4          5       6       7       8        9        0        1    2   3  #0
            cut $SX  $OY    $RED ''  ''        ''      ''         ''      ''   $X6'‚òÖ'     ' '                                     #1
            cut $SX $[OY+1] $GRN ''  ''        ''      ''      $X4'_' $cyn'‚ùÖ' $GRN'|' $BLU'‚óè'      ' '                            #2
            cut $SX $[OY+2] $GRN ''  ''        ''      ''      $X4'-'     '/' $YLW'‚óã' $GRN'\\' $CYN'‚ùÑ'  $GRN'-'      ' '          #3
            cut $SX $[OY+3] $GRN ''  ''        ''      ''  $RED$X4'‚óè' $GRN'/'     '|'     '\\'     '\\' $ylw'‚óã'      ' '          #4
            cut $SX $[OY+4] $GRN ''  ''     $X2'_'     '/'    $cyn'‚ùÑ' $GRN'/' $blu'‚óè' $GRN'\\' $cyn'‚ùÖ'  $GRN'\\'     ' '          #5
            cut $SX $[OY+5] $GRN ''  '' $red$X2'‚óã' $GRN'/'        '/'     '/'     '|'     '\\' $CYN'‚ùÑ'  $GRN'\\' $RED'‚óè'  ' '     #6
            cut $SX $[OY+6] $GRN '_' '/'   $cyn'‚ùÖ' $GRN'/'    $YLW'‚óè' $GRN'/'     '|' $RED'‚óã'  $GRN'\\' $cyn'‚ùÖ'  $GRN'\\' '-' ' ' #7
            cut $SX $[OY+7] $BLK ''  ''        ''      ''         ''      ''   $X6'‚ïë'     ' ';;                                   #8
        *:12|*:0[12])
            mov - && BP3[i]="tree3 $OX $OY 8 9 $SC $SM $CS $CL $AS $AL" || { unset BP3[i]; return; }
            X2="_Y_$[OX+1]H" X2="_Y_$[OX+2]H" X3="_Y_$[OX+3]H" X4="_Y_$[OX+4]H"
            #00000000001
            #01234567890
            #1  \|
            #2   \| |_
            #3_\_ ‚ïë/
            #4 /\ ‚ïë \/_
            #5   \‚ïë /
            #6    ‚ïë/
            #7    ‚ïë
            #8    ‚ïë               0     0     0     0       0       0       0    0   0   1
            ####################  1     2     3     4       5       6       7    8   9   0  #0
            cut $SX  $OY    $T3C ''    '' $X2'\\'  '|'     ' '                              #1
            cut $SX $[OY+1] $BLK ''    ''    '' $X3'\\'    '|'     ' ' $T3C'|'  '_' ' '     #2
            cut $SX $[OY+2] $T3C '_'   '\\'  '_'   ' ' $BLK'‚ïë'     '/'     ' '              #3
            cut $SX $[OY+3] $T3C '' $X1'/'   '\\'  ' ' $BLK'‚ïë' $T3C' '     '\\' '/' '_' ' ' #4
            cut $SX $[OY+4] $BLK ''    ''    '' $X3'\\'    '‚ïë'     ' '     '/'  ' '         #5
            cut $SX $[OY+5] $BLK ''    ''    ''    ''   $X4'‚ïë'     '/'     ' '              #6
            cut $SX $[OY+6] $BLK ''    ''    ''    ''   $X4'‚ïë'     ' '                      #7
            cut $SX $[OY+7] $BLK ''    ''    ''    ''   $X4'‚ïë'     ' ';;                    #8
        *:0[345]|*:09|*:1[01])
            mov - && BP3[i]="tree3 $OX $OY 8 9 $SC $SM $CS $CL $AS $AL" || { unset B3[i]; return; }
            X1="_Y_$[OX+1]H" X2="_Y_$[OX+2]H" X4="_Y_$[OX+4]H"
            #00000000001
            #01234567890
            #1  /‚Äæ‚Äæ/‚Äæ\
            #2/‚Äæ‚Äæ\|\|/
            #3\_\/‚ïë/
            #4 /‚Äæ\‚ïë __
            #5 \_\‚ïë|/_|
            #6    ‚ïë/
            #7    ‚ïë
            #8    ‚ïë               0     0       0        0        0       0       0       0    0   1
            ####################  1     2       3        4        5       6       7       8    9   0  #0
            cut $SX  $OY    $T3C ''    ''   $X2'/'      '‚Äæ'      '‚Äæ' $T3C'/'     '‚Äæ'     '\\' ' '     #1
            cut $SX $[OY+1] $T2C '/'   '‚Äæ'     '‚Äæ'      '\\' $BLK'|' $T3C'\\'    '|'     '/'  ' '     #2
            cut $SX $[OY+2] $T2C '\\'  '_' $BLK'\\' $T2C'/'  $BLK'‚ïë' $T3C'/'     ' '                  #3
            cut $SX $[OY+3] $T3C '' $X1'/'     '‚Äæ'      '\\' $BLK'‚ïë'     ' ' $T2C'_'     '_'  ' '     #4
            cut $SX $[OY+4] $T3C '' $X1'\\'    '_'  $BLK'\\'     '‚ïë' $T2C'|' $BLK'/' $T2C'_'  '|' ' ' #5
            cut $SX $[OY+5] $BLK ''    ''      ''       ''    $X4'‚ïë'     '/'     ' '                  #6
            cut $SX $[OY+6] $BLK ''    ''      ''       ''    $X4'‚ïë'     ' '                          #7
            cut $SX $[OY+7] $BLK ''    ''      ''       ''    $X4'‚ïë'     ' ';;                        #8
        *)
            mov - && BP3[i]="tree3 $OX $OY 8 9 $SC $SM $CS $CL $AS $AL" || { unset B3[i]; return; }
            X2="_Y_$[OX+2]H" X3="_Y_$[OX+3]H" X4="_Y_$[OX+4]H"
            #00000000001
            #01234567890
            #1  /‚Äæ‚Äæ‚Äæ\
            #2  \ | /
            #3/‚Äæ‚Äæ\‚ïë/
            #4\_\/‚ïë/‚Äæ‚Äæ\
            #5   \‚ïë|/_/
            #6    ‚ïë/
            #7    ‚ïë
            #8    ‚ïë               0     0       0        0        0       0       0       0   0    1
            ####################  1     2       3        4        5       6       7       8   9    0  #0
            cut $SX  $OY    $T3C ''    ''   $X2'/'      '‚Äæ'      '‚Äæ'     '‚Äæ'     '\\'    ' '          #1
            cut $SX $[OY+1] $T3C ''    ''   $X2'\\'     ' '  $BLK'|'     ' ' $T3C'/'     ' '          #2
            cut $SX $[OY+2] $T3C '/'   '‚Äæ'     '‚Äæ'      '\\' $BLK'‚ïë' $T3C'/'     ' '                  #3
            cut $SX $[OY+3] $T3C '\\'  '_' $BLK'\\' $T3C'/'  $BLK'‚ïë' $T3C'/'     '‚Äæ'     '‚Äæ' '\\' ' ' #4
            cut $SX $[OY+4] $BLK ''    ''      ''    $X3'\\'     '‚ïë' $T3C'|' $BLK'/' $T3C'_' '/'  ' ' #5
            cut $SX $[OY+5] $BLK ''    ''      ''       ''    $X4'‚ïë'     '/'     ' '                  #6
            cut $SX $[OY+6] $BLK ''    ''      ''       ''    $X4'‚ïë'     ' '                          #7
            cut $SX $[OY+7] $BLK ''    ''      ''       ''    $X4'‚ïë'     ' ';;                        #8
    esac
}
#-------------------------------------------{ penis mode }--------------------------------------------------------------
[[ $penis ]] && {

heroendx=$[endx-15]
heroendy=$[endy-9 ]

enl1=('' ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ ‚îÄ)
enl2=('' _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _)
enl3=('' ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï ‚éï)
sprite_penis1 () {
    mov - || { unset HER[i];  return; }
    [[ $1 ]] || control_hero1 $H1X $H1Y
    if [[ $life -gt 0 ]]; then
       OX=$H1X OY=$H1Y CS=1 CL=$[16+G]
    else # when hero's health goes to 0 it starts to fall, explodes and bounces on the ground
       AS=0 SM=3  #spd=0.1
       [[ $OY -lt $TY ]] && ((OY++))  || { TY=$[heroendy-C2+2]; ((C2--)); }
       [[ $OY -gt $TY ]] && ((OY--))  ||   TY=$[heroendy+2]
       [[ $OX -gt -10 && $C1 -eq 0 ]] && { BOOM $SX $[OY-2]; C1=15; }
       screen+="\\e[$[endy-1];$[OX+OW]H$LND "
    fi

    case $type in
     'duel')
         re="crate ($[OX+6+G]|$[OX+7+G]|$[OX+8+G]|$[OX+9+G]|$[OX+10+G]) ($[OY+2]|$[OY+3]|$[OY+4]|$[OY+5]|$[OY+6]).*";;
     'team')
         re="(life|ammo|gunup) ($[OX+11+G]|$[OX+12+G]) ($[OY+1]|$[OY+2]|$[OY+3]|$[OY+4]).*|"
        re+="alien ($[OX+11+G]|$[OX+12+G]) ($[OY+1]|$[OY+2]).*|alien ($[OX+6]|$[OX+7]) ($[OY+3]|$[OY+4]).*|"
        re+="bfire ($[OX+11+G]|$[OX+12+G]) ($[OY+2]|$[OY+3]).*|bfire ($[OX+6]|$[OX+7]) ($[OY+3]|$[OY+4]).*|"
        re+="boss ($[OX+11+G]|$[OX+12+G]) $[OY-1].*";;
    esac

    T1=${shoot[AS]}; local x1=$OX x2=$SX
    CM1=$SKY$H1C$BLD CM2=$SKY$DIM$H1C CM3=$SKY$S1C
    ((AS<=1)) && ((x1--))
    ((x2< 1)) && x2=1; [[ $1 ]] && ((x1++)); X2="_Y_$[x2+2]H" X3="_Y_$[x1-1]H" X4="_Y_$[x2+10+G]H"
    #00000000001111111#0
    #01234567890123456#0
    #1                #1
    #2   _____ _____  #2
    #3    .-‚îÄ‚îÄ‚ï®‚îÄ‚îÄ‚ñÖ‚ñÉ   #3
    #4 -=‚ï≥ ______‚ñú‚ñâ‚ñâ‚ññ #4
    #5   / |\     ‚ñî‚ñî  #5
    #6  (__)_)        #6
    #7                #7    0  0     0     0 0  0      0      0     0 1  1                   1     1     1     1 1 #0
    ######X####Y####CLR#    1  2     3     4 5  6      7      8     9 0  1                   2     3     4     5 6 #0
    cut $SX  $OY    $SKY    '' '' $X2‚éï     ‚éï ‚éï  ‚éï      ‚éï      ‚éï     ‚éï ‚éï  ‚éï                   ‚éï     ‚éï     ‚éï     ‚éï   #1
    cut $SX $[OY+1] $CM1    '' '' $X2‚éï                       ${mainrotor[AS]}                    ${enl3[@]:1:$G}   #2
    cut $SX $[OY+2] $CM1    ‚éï  ‚éï     ‚éï     ‚éï .  -      ‚îÄ      ‚îÄ     ‚ï® ‚îÄ  ${enl1[@]:1:$G} $CM3‚ñÖ     ‚ñÉ $SKY‚éï     ‚éï ‚éï #3
    cut $SX $[OY+3] $CM2    ‚éï    $T1   $CM2‚ï≥ ‚éï  _      _      _     _ _  ${enl2[@]:1:$G} $CM3‚ñú     ‚ñâ     ‚ñâ     ‚ññ ‚éï #4
    cut $SX $[OY+4] $CM2    ‚éï  ‚éï     ‚éï     / ‚éï \| $CM1\\      ‚éï $SKY‚éï ‚éï  ${enl3[@]:1:$G}     ‚éï $CM3‚ñî     ‚ñî $SKY‚éï ‚éï #5
    cut $SX $[OY+5] $CM2 $X3‚éï  ‚éï    \(     _ _ \)      _ $CM1\)     ‚éï ‚éï  ''               $X4‚éï     ‚éï     ‚éï     ‚éï   #6
    cut $SX $[OY+6] $SKY $X3‚éï  ‚éï     ‚éï     ‚éï ‚éï  ‚éï      ‚éï      ‚éï     ‚éï ‚éï                                            #7

    [[  $C1 -gt 0 ]]  && ((C1--))
    collision 1 "$re" && { BOOM $OX $OY; ((life--)); }
    HER[i]="penis1 $OX $OY 7 $[16+G] $SC $SM $CS $CL $AS $AL $C1 $C2"
}

sprite_penis2 () {
    mov - || { unset HER[i]; return; }
    if [[ $life2 -gt 0 ]]; then
        CS=1 CL=16 OX=$H2X OY=$H2Y
        [[ $penis ]] && CL=$[15+G]
    else # when heros health goes to 0 it starts to fall, explodes and bounces on the ground
        AS=0 SM=3 H2Y=
        [[ $OY -lt $TY ]] && ((OY++))  || { TY=$[heroendy-C2+2]; ((C2--)); }
        [[ $OY -gt $TY ]] && ((OY--))  ||   TY=$[heroendy+2]
        [[ $OX -gt -10 && $C1 -eq 0 ]] && { BOOM $SX $[OY-2]; C1=15; }
        screen+="\\e[$[endy-1];$[OX+OW]H$LND "
    fi

    T1=${shoot[AS]}; local x1=$OX x2=$SX
    CM1=$SKY$H2C$BLD CM2=$SKY$DIM$H2C CM3=$SKY$S2C
    ((AS<=1)) && ((x1--))
    ((x2< 1)) && x2=1; [[ $1 ]] && ((x1++))
    case $type in
     'duel') control_hero2 $[H2X-10] $H2Y
             re="crate ($[OX-4]|$[OX-3]|$[OX-2]|$[OX-1]|$OX) ($[OY+2]|$[OY+3]|$[OY+4]|$[OY+5]|$[OY+6]).*"
             X1="_Y_$[x2+1]H" X2="_Y_$[x1+5+G2]H" X3="_Y_$[x2+G2]H"
             #00000000001111111#0
             #01234567890123456#0
             #1                #1
             #2  _____ _____   #2
             #3   ‚ñÉ‚ñÖ‚îÄ‚îÄ‚ï®‚îÄ‚îÄ-.    #3
             #4 ‚ñó‚ñâ‚ñâ‚ñõ______ ‚ï≥=- #4
             #5  ‚ñî‚ñî     /| \   #5
             #6        (_(__)  #6
             #7                #7  0     0  0  0     0                    0     0 0  0     1  1 1      1      1  1 1 #0
             ######X####Y#####CLR# 1     2  3  4     5                    6     7 8  9     0  1 2      3      4  5 6 #0
             cut $SX  $OY    $SKY  '' $X3‚éï  ‚éï  ‚éï     ‚éï                    ‚éï     ‚éï ‚éï  ‚éï     ‚éï  ‚éï ‚éï      ‚éï             #1
             cut $SX $[OY+1] $CM1  '' $X1${enl3[@]:1:$G2}                  ${mainrotor[AS]}            ‚éï             #2
             cut $SX $[OY+2] $CM3  ‚éï     ‚éï  ‚éï  ‚ñÉ     ‚ñÖ $CM2${enl1[@]:1:$G2}     ‚îÄ ‚ï®  ‚îÄ     ‚îÄ  - .      ‚éï      ‚éï  ‚éï ‚éï #3
             cut $SX $[OY+3] $CM3  ‚éï     ‚ñó  ‚ñâ  ‚ñâ     ‚ñõ $CM2${enl2[@]:1:$G2}     _ _  _     _  _ ‚éï      ‚ï≥      $T1  ‚éï #4
             cut $SX $[OY+4] $CM3  ‚éï     ‚éï  ‚ñî  ‚ñî $SKY‚éï     ${enl3[@]:1:$G2}     ‚éï ‚éï  ‚éï $CM2/ \| ‚éï $CM1\\      ‚éï  ‚éï ‚éï #5
             cut $SX $[OY+5] $CM2  '' $X1‚éï  ‚éï  ‚éï     ‚éï                    '' $X2‚éï ‚éï \(     _ \( _      _ $CM1\)  ‚éï ‚éï #6
             cut $SX $[OY+6] $SKY  ''    '' '' ''    ''                   '' $X2‚éï ‚éï  ‚éï     ‚éï  ‚éï ‚éï      ‚éï      ‚éï  ‚éï;; #7

     'team') control_hero2 $H2X $H2Y
             re="(life|ammo|gunup) ($[OX+11+G2]|$[OX+12+G2]) ($[OY+1]|$[OY+2]|$[OY+3]|$[OY+4]).*|"
             re+="alien ($[OX+11+G2]|$[OX+12+G2]) ($[OY+1]|$[OY+2]).*|alien ($[OX+6]|$[OX+7]) ($[OY+3]|$[OY+4]).*|"
             re+="bfire ($[OX+11+G2]|$[OX+12+G2]) ($[OY+2]|$[OY+3]).*|bfire ($[OX+6]|$[OX+7]) ($[OY+3]|$[OY+4]).*|"
             re+="boss ($[OX+11+G2]|$[OX+12+G2]) $[OY-1].*"

             X2="_Y_$[x2+2]H" X3="_Y_$[x1-1]H" X4="_Y_$[x2+10+G2]H"
             #00000000001111111#0
             #01234567890123456#0
             #1                #1
             #2   _____ _____  #2
             #3    .-‚îÄ‚îÄ‚ï®‚îÄ‚îÄ‚ñÖ‚ñÉ   #3
             #4 -=‚ï≥ ______‚ñú‚ñâ‚ñâ‚ññ #4
             #5   / |\     ‚ñî‚ñî  #5
             #6  (__)_)        #6
             #7                #7    0  0     0     0 0  0      0      0     0 1  1                    1     1     1     1 1 #0
             ######X####Y####CLR#    1  2     3     4 5  6      7      8     9 0  1                    2     3     4     5 6 #0
             cut $SX  $OY    $SKY    '' '' $X2‚éï     ‚éï ‚éï  ‚éï      ‚éï      ‚éï     ‚éï ‚éï  ‚éï                    ‚éï     ‚éï     ‚éï     ‚éï   #1
             cut $SX $[OY+1] $CM1    '' '' $X2‚éï                       ${mainrotor[AS]}                     ${enl3[@]:1:$G2}  #2
             cut $SX $[OY+2] $CM1    ‚éï  ‚éï     ‚éï     ‚éï .  -      ‚îÄ      ‚îÄ     ‚ï® ‚îÄ  ${enl1[@]:1:$G2} $CM3‚ñÖ     ‚ñÉ $SKY‚éï     ‚éï ‚éï #3
             cut $SX $[OY+3] $CM2    ‚éï    $T1   $CM2‚ï≥ ‚éï  _      _      _     _ _  ${enl2[@]:1:$G2} $CM3‚ñú     ‚ñâ     ‚ñâ     ‚ññ ‚éï #4
             cut $SX $[OY+4] $CM2    ‚éï  ‚éï     ‚éï     / ‚éï \| $CM1\\      ‚éï $SKY‚éï ‚éï  ${enl3[@]:1:$G2}     ‚éï $CM3‚ñî     ‚ñî $SKY‚éï ‚éï #5
             cut $SX $[OY+5] $CM2 $X3‚éï  ‚éï    \(     _ _ \)      _ $CM1\)     ‚éï ‚éï  ''                $X4‚éï     ‚éï     ‚éï     ‚éï   #6
             cut $SX $[OY+6] $SKY $X3‚éï  ‚éï     ‚éï     ‚éï ‚éï  ‚éï      ‚éï      ‚éï     ‚éï ‚éï                                             #7
     esac

     [[ $C1 -gt 0   ]] && ((C1--))
     collision 2 "$re" && { BOOM $OX $OY; ((life2--)); }
     HER[i]="penis2 $OX $OY 7 $[15+G2] $SC $SM $CS $CL $AS $AL $C1 $C2"
}

#------------------------{ Shoots }-------------------------------------------------------------------------------------
case "$day:$month" in
      *:[01][1-4]) CM1=$SKY$BLD$CYN;;
                *) CM1=$SKY$BLD$WHT;;
esac
cumback=(              # ‚óè ‚äï ‚äô ‚óã
    "${CM1}‚Äî ${CM1}‚Äæ"  # ‚óã‚Äæ‚Äî ‚óã‚Äî‚Äæ
    "${CM1}‚Äî ${CM1}‚Äî"  # ‚óã‚Äî‚Äî ‚óã‚Äæ‚Äî
    "${CM1}‚Äî ${CM1}_"  # ‚óã_‚Äî ‚óã‚Äî_
    "${CM1}‚Äî ${CM1}‚Äî") # ‚óã‚Äî‚Äî ‚óã_‚Äî
cum=(                  # ‚óè ‚äï ‚äô ‚óã
    "${CM1}‚Äæ ${CM1}‚Äî"  # ‚Äæ‚Äî‚óã ‚Äî‚Äæ‚óã
    "${CM1}‚Äî ${CM1}‚Äî"  # ‚Äî‚Äî‚óã ‚Äæ‚Äî‚óã
    "${CM1}_ ${CM1}‚Äî"  # _‚Äî‚óã ‚Äî_‚óã
    "${CM1}‚Äî ${CM1}‚Äî") # ‚Äî‚Äî‚óã _‚Äî‚óã

sprite_piu1 () {
    case $type in
        'duel') re="${ht}2 ($OX|$[OX+1]) ($[OY-1]|$[OY-2]|$[OY-3]|$[OY-4]).*";;
        'team') re="alien ($OX|$[OX+1]) $[OY-1].*|boss ($OX|$[OX+1]) ($[OY-2]|$[OY-3]|$[OY-4]).*";;
    esac;  mov + && PIU[i]="piu1 $OX $OY 1 4 $SC $SM $CS $CL $AS 3" || { unset PIU[i]; return; }

    case "$day:$month" in
          *:[01][1-4]) CM1=$SKY$BLD$CYN;;
                    *) CM1=$SKY$BLD$WHT;;
    esac

    #01234
    #1 ‚Äî_‚óã
    ################  1    2    3       4 #0
    cut $OX $OY $SKY ' ' ${cum[AS]} $CM1‚óã #1
    collision 1 "$re" $OX $[OY-1] && unset PIU[i]
}

sprite_piu2 () {
    case $type in
         'duel') direction='-' re="${ht}1 ($[OX-9-G]|$[OX-10-G]) ($[OY-1]|$[OY-2]|$[OY-3]|$[OY-4]).*";;
         'team') direction='+' re="alien ($OX|$[OX+1]) $[OY-1].*|boss ($OX|$[OX+1]) ($[OY-2]|$[OY-3]|$[OY-4]).*";;
    esac;   mov $direction && PIU[i]="piu2 $OX $OY 1 4 $SC $SM $CS $CL $AS 3" || { unset PIU[i]; return; }

    case "$day:$month" in
          *:[01][1-4]) CM1=$SKY$BLD$CYN;;
                    *) CM1=$SKY$BLD$WHT;;
    esac

    case "$type" in
         'duel')
                 #01234
                 #1‚óã‚Äî_
                 ################  1      2    3       4   #0
                 cut $SX $OY $CM1 '‚óã' ${cumback[AS]} $SKY‚éï;; #1

              *) #01234
                 #1 ‚Äî_‚óã
                 ################ 1   2   3        4   #0
                 cut $OX $OY $SKY ‚éï ${cum[AS]} $CM1‚óã;; #1
    esac;        collision 2 "$re" $OX $[OY-1] && unset PIU[i]
}

} # the end of the penis (the tip)
#======================================{ Main game loop single or server mode }=========================================
game () {
    while true; do
        #-{ Empty screen, print game status and FPS }--------------------------
        screen=; status; [[ $showfps ]] && fps_counter
        #-{ Add background }---------------------------------------------------
        [[ $background ]] && add_backgound birds msngr clouds houses trees moving_land
        #-{ Move bitplans }----------------------------------------------------
        BP1=("${BP1[@]}"); for i in ${!BP1[@]}; { OI=(${BP1[i]}); print_sprite; } # small(far) background objects
        BP2=("${BP2[@]}"); for i in ${!BP2[@]}; { OI=(${BP2[i]}); print_sprite; } # medium background objects
        PIU=("${PIU[@]}"); for i in ${!PIU[@]}; { OI=(${PIU[i]}); print_sprite; } # heroes fire
        HER=("${HER[@]}"); for i in ${!HER[@]}; { OI=(${HER[i]}); print_sprite; } # heroes
        ENM=("${ENM[@]}"); for i in ${!ENM[@]}; { OI=(${ENM[i]}); print_sprite; } # enemies
        BP3=("${BP3[@]}"); for i in ${!BP3[@]}; { OI=(${BP3[i]}); print_sprite; } # big(closer) background objects
        #-{ BOSS }-------------------------------------------------------------
        if [[ $[frags+frags2] -ge $tillboss && $type != duel ]]; then # add boss object
            [[ $bossborn ]] || { ENM+=("boss $endx $halfy 6 14 0 0 1 0 $[RANDOM%3] 3 20 10"); bossborn=true; }
            boss_health # Print boss' health bar
            #-{ Add aliens }---------------------------------------------------
            [[ $bhealth -gt 0 ]] && add_enm $EX $EY 5 # aliens come out from boss
        else                                          #
            add_enm $endx $[4+RANDOM%enmyendy]        # aliens come out from edge
        fi
        #-{ Print everything }-------------------------------------------------
        printf "$screen"
        #-{ Check the end and send data to client }----------------------------
        case $game$type in
              *team) [[ ${HER[@]} ]] || the_end=lose;;&
              *duel) [[ ${HER[1]} ]] || if [[ $life -gt 0 ]]; then listener; sender $caddr $cport lose; mess win
                                                              else listener; sender $caddr $cport win ; mess lose; fi;;&
            server*) listener; sender $caddr $cport "$screen";;
        esac
        if [[ $the_end ]]; then
            case $game in 'server') listener; sender $caddr $cport $the_end;; esac
            mess $the_end; [[ $type != duel ]] && starship_intro starship
        fi
    done
}
#=========================================={ Client mode game loop }====================================================
game_client () {
    while true; do
        read_input
        sender $saddr $sport $input
        screen=$(nc -l -p $cport 2>/dev/null)
        case $screen in
             'win' ) mess   "$screen"; [[ $type != duel ]] && starship_intro starship;;
             'lose') mess   "$screen";;
             *     ) printf "$screen";;
        esac
    done
}
#============================================={ Starship intro }========================================================
starship_intro () {
    [[ $1 =~ starship ]] || return
    time_to_start=$((SECONDS+10))
    BP1=("Sun $Sunsendx 1 9 18 0 7 1 20 0 2") BP2=() BP3=() BP4=()
    ad_new= ad='Got a ticket to Mars?'; ad_plane_text; fill_screen; cursor off
    T1=($[halfx-8] $[halfx-15] $[halfx-18] $[endx-5] $[endx-9]  $[endx-15] $[endx-17] $[endx-25] $[endx-40] 3 7 11 15 20)
    T2=($[endx-7]  $[endx-11]  $[endx-35] 5 17 23)
    T3=($[endx-8]  $[endx-25]  4 23)
       # reserved for burning # type      $OX         $OY      $OH $OW $SC $SM $CS $CL $AS $AL
        BP2+=('' '' ''); BP2+=("windsock  $[halfx-17] $[endy-4] 2   8   0   0   1   7   0   2")    # windsock
                         BP2+=("starship   $halfx      $endy    10  7   0   10  10  10  0   5")    # starship
                         BP3+=("startable $[halfx-4]  $[endy-2] 8   15  0   50  10  10  0   1")    # startable
                         BP4+=("lift      $[halfx+8]  $[endy-4] 1   3   0   30  1   1   0   4")    # lift
    for i in ${T1[@]}; { BP1+=("tree1      $i         $tre1endy 4   2   0  -1   1   5   0   0"); } # Plant
    for i in ${T2[@]}; { BP2+=("tree2      $i         $tre2endy 6   5   0  -1   1   5   0   0"); } # some
    for i in ${T3[@]}; { BP3+=("tree3      $i         $tre3endy 9   9   0  -1   1   9   0   0"); } # trees
    while true; do
        #-{ Empty screen, print game status adnd FPS }-------------------------
        screen=; [[ $showfps ]] && fps_counter; ((SECONDS==time_to_start)) && lift=up
        # Start the engine (add exhaust sprite)
        [[   $ex1   ]] && { BP2+=( "exhaust $[halfx-31] $[endy-3] 4 33 0 7 1 33 0 9"); ex1=; }
        #-{ Add background }---------------------------------------------------
        [[ $background ]] && add_backgound birds msngr clouds land
        #-{ Move bitplans }----------------------------------------------------
        BP1=("${BP1[@]}"); for i in ${!BP1[@]}; { OI=(${BP1[i]}); print_sprite; } # small(far) background objects
        BP2=("${BP2[@]}"); for i in ${!BP2[@]}; { OI=(${BP2[i]}); print_sprite; } # medium background objects
        BP3=("${BP3[@]}"); for i in ${!BP3[@]}; { OI=(${BP3[i]}); print_sprite; } # big(closer) background objects
        BP4=("${BP4[@]}"); for i in ${!BP4[@]}; { OI=(${BP4[i]}); print_sprite; } # lift
        #-{ Print everything }-------------------------------------------------
        printf "$screen"
    done
    exit
}
#============================================{ Initialisation }=========================================================
                hw=16 hh=6 ht=hero
[[ $penis ]] && hw=16 hh=7 ht=penis
trap : ALRM; trap bye INT TERM SIGINT SIGTERM EXIT
clear; starship_intro $1; mess "help"; sleep 2
clear; intro; menu
clear; fill_screen
cursor off
BP1=("Sun $Sunsendx 1 9 18 0 7 1 20 0 2")                       # Sun
H1X=2 H1Y=2 HER=("${ht}1 $H1X $H1Y $hh $hw 0 0 1 15 0 3 15 10") # Hero

#-{ If server }---------------------------------------------------------------------------------------------------------
case $game:$type in
    server:team) H2X=2         H2Y=$[halfy-2];;&
    server:duel) H2X=$heroendx H2Y=$[halfy-2] H1Y=$[halfy-2] enmax=0
                 [[ $penis ]] && H2X=$[heroendx-G2]; ad_plane_text;;&
    server:*   ) XY 2 1 $SKY$RED"Server mode. Waiting for client..."
                 HER+=("${ht}2 $H2X $H2Y $hh $hw 0 0 1 15 0 3 15 10")
                 clnt=( $(nc -l -p $sport) )
                 caddr=${clnt[0]}
                 cport=${clnt[1]}
                 H2C=${clnt[2]:-$DHC}
                 H2S=${clnt[3]:-$DHS}
                 S2C=${clnt[4]:-$DSC};;
#-{ If client }---------------------------------------------------------------------------------------------------------
    client:*   ) XY 2 1 $SKY$RED"Client mode. Waiting for server..."
                 sender $saddr $sport "${caddr[0]} $cport $H1C $H1S $S1C"
                 game_client;;
esac
game
